import{serializable as o,RectTransform as lr,Behaviour as c,Mathf as v,GameObject as m,OrbitControls as Ut,Text as Y,NeedleXRSession as V,getTempVector as w,Camera as ve,serializeable as g,WebXR as _e,setWorldPosition as ct,Rigidbody as D,AudioSource as U,InstantiateOptions as hr,Renderer as O,InstancingUtil as cr,Button as Wt,ActionBuilder as _,USDObject as ht,BehaviorModel as $,TriggerBuilder as A,Volume as pr,getWorldPosition as Et,getParam as P,Gizmos as E,ParticleSystem as zt,setParamWithoutReload as Rt,EventList as b,setWorldQuaternion as de,getWorldQuaternion as me,Animator as Ht,WebXRImageTracking as dr,DeviceUtilities as x,LODGroup as mr,syncField as I,showBalloonMessage as f,AssetReference as Oe,screenshot2 as ur,DragControls as fr,Animation as dt,USDZExporter as Gt,isDevEnvironment as K,delay as $t,SceneSwitcher as gr,RoomEvents as br,Collider as mt,LogType as ye,WaitForSeconds as xr,isMobileDevice as wr,NeedleMenu as vr,getTempQuaternion as _r,AnimationCurve as Or,NeedleXRController as ue,XRControllerFollow as yr,delayForFrames as qt,MeshRenderer as Pr,ParticleSystemShapeType as St,isDestroyed as Pe,instantiate as Cr,AnimationExtension as jr,PlayAnimationOnClick as fe,getOrAddComponent as Sr,FileReference as ut,findObjectOfType as Ce,ImageReference as Dr,PlayableDirector as Mr,TypeStore as p,WebXRPlaneTracking as je,WebXRButtonFactory as Tr,isQuest as Dt}from"./needle-engine@4.8.6.js";import{o as Se,P as Er,aB as C,y as pt,h as De,a6 as Qt,aS as At,V as y,i as $r,M as Me,T as Ar,u as Ir,t as Lr,f as Fr,bk as Nr,bE as Vr,bN as Ur,cW as Wr,cX as zr,aq as ge,a1 as Rr,cN as Hr,cy as Gr,cD as qr,cY as Qr,cZ as Kr,c_ as Yr,ag as be}from"./three@0.169.9.js";import{C as Zr,a as kr,b as Br}from"./three-examples.aad5d03b.js";import"./gltf-progressive.f648adde.js";import"./three-mesh-ui.3cc9bdd1.js";import"./three-quarks.e59a329f.js";import"./postprocessing.8347858a.js";var Xr=Object.defineProperty,Jr=Object.getOwnPropertyDescriptor,Te=(s,t,r,i)=>{for(var e=i>1?void 0:i?Jr(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Xr(t,r,e),e};class Kt extends c{constructor(){super(...arguments),this.safeArea=new Se(0,0)}update(){var e,n,a;const t=this.context.domWidth/this.safeArea.x,r=this.context.domHeight/this.safeArea.y,i=v.clamp(Math.min(t,r),0,1);(e=this.rectTransform)==null||e.scale.setScalar(i),(a=(n=this.rectTransform)==null?void 0:n.shadowComponent)==null||a.scale.setScalar(i)}}Te([o(lr)],Kt.prototype,"rectTransform",2);Te([o(Se)],Kt.prototype,"safeArea",2);var ti=Object.defineProperty,ei=Object.getOwnPropertyDescriptor,Yt=(s,t,r,i)=>{for(var e=i>1?void 0:i?ei(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&ti(t,r,e),e};class ft extends c{constructor(){super(...arguments),this.createMenuButton=!1,this.teleportVRPlayer=!1,this.ignoreYInVR=!1,this.menuButton=null}get orbitalCamera(){return this._orbitalCamera??(this._orbitalCamera=m.findObjectOfType(Ut)),this._orbitalCamera}awake(){this.createMenuButton&&this.addButton()}addButton(){var i;this.menuButton&&this.removeButton();const t=((i=this.gameObject.getComponentInChildren(Y))==null?void 0:i.text)??this.gameObject.name,r=document.createElement("button");this.menuButton=r,r.innerText=t.replace("_"," "),r.setAttribute("priority","40"),r.addEventListener("click",()=>this.use()),this.context.menu.appendChild(r)}removeButton(){this.menuButton&&(this.menuButton.remove(),this.menuButton=null)}use(){var r,i;(r=this.orbitalCamera)==null||r.setCameraTargetPosition(this.worldPosition);const t=(i=V.active)==null?void 0:i.rig;if(this.teleportVRPlayer&&this.context.isInVR&&t){const e=w(this.worldPosition);this.ignoreYInVR&&(e.y=t.gameObject.worldPosition.y),t.gameObject.worldPosition=e}}}Yt([o()],ft.prototype,"createMenuButton",2);Yt([o()],ft.prototype,"teleportVRPlayer",2);Yt([o()],ft.prototype,"ignoreYInVR",2);class ri extends c{constructor(){super(...arguments),this.cam=null}onEnable(){this.cam=this.gameObject.getComponent(ve),this.cam||(console.warn("CameraLayer requires a Camera component"),this.enabled=!1)}onAfterRender(){if(!this.cam)return;const t=this.scene.background;this.context.renderer.autoClearColor=!1,this.cam.cam instanceof Er&&this.context.updateAspect(this.cam.cam),this.scene.background=null,this.context.renderer.render(this.scene,this.cam.cam),this.scene.background=t}}var ii=Object.defineProperty,si=Object.getOwnPropertyDescriptor,gt=(s,t,r,i)=>{for(var e=i>1?void 0:i?si(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&ii(t,r,e),e};class Z extends c{constructor(){super(...arguments),this.strength=10,this.maxInstances=10,this._instances=[],this._index=-1,this._onPointerDown=t=>{t.button===0&&this.throwBall(t.space.worldPosition,t.space.worldForward)}}start(){this.prefab&&m.setActive(this.prefab,!1),this.webXR??(this.webXR=m.findObjectOfType(_e))}onEnable(){this.context.input.addEventListener("pointerdown",this._onPointerDown)}onDisable(){this.context.input.removeEventListener("pointerdown",this._onPointerDown)}throwBall(t,r){var a,l;if(!this.prefab)return;if(this._instances.length<this.maxInstances){const h=new hr;h.position=t;const d=m.instantiate(this.prefab,h);if(!d)return;this._instances.push(d)}const i=++this._index,e=this._instances[i%this._instances.length];if(!e)return;ct(e,t),m.setActive(e,!0),(a=this.audioSource)==null||a.stop(),(l=this.audioSource)==null||l.play();const n=m.getComponent(e,D);n&&(r.multiplyScalar(this.strength),n.resetForcesAndTorques(),n.resetVelocities(),n==null||n.applyImpulse(r))}}gt([g(C)],Z.prototype,"prefab",2);gt([g(U)],Z.prototype,"audioSource",2);gt([g()],Z.prototype,"strength",2);gt([g()],Z.prototype,"maxInstances",2);var ni=Object.defineProperty,ai=Object.getOwnPropertyDescriptor,Ee=(s,t,r,i)=>{for(var e=i>1?void 0:i?ai(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&ni(t,r,e),e};class Zt extends c{constructor(){super(...arguments),this.applyOnStart=!0,this.randomMetallicRoughness=!0}start(){{const t=this.gameObject.getComponent(O);if(!t)return;for(let r=0;r<t.sharedMaterials.length;r++)t.sharedMaterials[r]=t.sharedMaterials[r].clone()}this.applyOnStart&&this.applyRandomColor()}applyRandomColor(){const t=this.gameObject.getComponent(O);if(!t){console.warn("Can not change color: No renderer on "+this.name);return}for(let r=0;r<t.sharedMaterials.length;r++){const i=t.sharedMaterials[r];i.color=new pt(Math.random(),Math.random(),Math.random()),this.randomMetallicRoughness&&i instanceof De&&(i.metalness=Math.random(),i.roughness=Math.random()*Math.random()),i.needsUpdate=!0,cr.markDirty(this.gameObject)}}}Ee([g()],Zt.prototype,"applyOnStart",2);Ee([g()],Zt.prototype,"randomMetallicRoughness",2);class oi extends c{constructor(){super(...arguments),this.renderer=null,this.collisionCount=0}start(){if(this.renderer=this.gameObject.getComponent(O),!!this.renderer){this._startColor||(this._startColor=[]);for(let t=0;t<this.renderer.sharedMaterials.length;t++)this.renderer.sharedMaterials[t]=this.renderer.sharedMaterials[t].clone(),this._startColor[t]=this.renderer.sharedMaterials[t].color.clone()}}onCollisionEnter(t){if(this.renderer){this.collisionCount+=1;for(let r=0;r<this.renderer.sharedMaterials.length;r++)this.renderer.sharedMaterials[r].color.setRGB(Math.random(),Math.random(),Math.random())}}onCollisionExit(t){if(!(!this.renderer||!this._startColor)&&(this.collisionCount-=1,this.collisionCount===0))for(let r=0;r<this.renderer.sharedMaterials.length;r++)this.renderer.sharedMaterials[r].color.copy(this._startColor[r])}}var li=Object.defineProperty,hi=Object.getOwnPropertyDescriptor,ci=(s,t,r,i)=>{for(var e=i>1?void 0:i?hi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&li(t,r,e),e};class $e extends c{update(){this.myMaterial&&(this.myMaterial._Speed*=1+this.context.time.deltaTime,this.myMaterial._Speed>1&&(this.myMaterial._Speed=5e-4),this.context.time.frame%30===0&&console.log(this.myMaterial._Speed))}}ci([o(Qt)],$e.prototype,"myMaterial",2);var pi=Object.defineProperty,di=Object.getOwnPropertyDescriptor,mi=(s,t,r,i)=>{for(var e=i>1?void 0:i?di(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&pi(t,r,e),e};class Ae extends c{click(){var t,r;(r=(t=this.buttonToClick)==null?void 0:t.onClick)==null||r.invoke()}}mi([o(Wt)],Ae.prototype,"buttonToClick",2);var ui=Object.defineProperty,fi=Object.getOwnPropertyDescriptor,gi=(s,t,r,i)=>{for(var e=i>1?void 0:i?fi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&ui(t,r,e),e};class Ie extends c{constructor(){super(...arguments),this.objectToMatrix=new Map}start(){var t;(t=this.target)==null||t.traverse(r=>{this.objectToMatrix.set(r,r.matrix.clone())})}onPointerClick(t){for(const[r,i]of this.objectToMatrix)r.matrix.copy(i),r.matrix.decompose(r.position,r.quaternion,r.scale),r.matrixWorldNeedsUpdate=!0}createBehaviours(t,r,i){if(r.uuid!==this.gameObject.uuid||!this.target)return;const e=_.parallel();for(const[h,d]of this.objectToMatrix){const u=ht.createEmpty();u.matrix=d,h.parent&&u.matrix.premultiply(h.parent.matrixWorld),i.document.add(u),e.addAction(_.transformAction(h,u,0,"absolute","none"))}const n=new $("click_to_reset",A.tapTrigger(this.gameObject),e);t.addBehavior(n);const a=ht.createEmpty();a.name="InputTarget",a.displayName=void 0,a.type="RealityKitComponent",a.onSerialize=h=>{h.appendLine("bool allowsDirectInput = 1"),h.appendLine("bool allowsIndirectInput = 1"),h.appendLine('uniform token info:id = "RealityKit.InputTarget"')},r.add(a);const l=ht.createEmpty();l.name="HoverEffect",l.displayName=void 0,l.type="RealityKitComponent",l.onSerialize=h=>{h.appendLine('uniform token info:id = "RealityKit.HoverEffect"')},r.add(l)}}gi([o(m)],Ie.prototype,"target",2);var bi=Object.defineProperty,xi=Object.getOwnPropertyDescriptor,kt=(s,t,r,i)=>{for(var e=i>1?void 0:i?xi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&bi(t,r,e),e};class bt extends c{constructor(){super(...arguments),this.apertureMultiplier=2,this.focalLength=.001,this.focusDistanceCutoff=25,this.volume=null,this.dofEffect=void 0}onEnable(){var t,r,i;this.volume=m.findObjectOfType(pr),this.dofEffect=(i=(r=(t=this.volume)==null?void 0:t.sharedProfile)==null?void 0:r.components)==null?void 0:i.find(e=>e.typeName==="DepthOfField"),this.orbit=m.findObjectOfType(Ut)}onBeforeRender(){var r;if(!((r=this.orbit)!=null&&r.controls))return;const t=this.orbit.controls.target.distanceTo(Et(this.orbit.gameObject));if(this.dofEffect){this.dofEffect.focusDistance.value=t,this.dofEffect.focalLength.value=this.focalLength;let i=v.inverseLerp(0,this.focusDistanceCutoff,t);i=v.clamp01(i),this.dofEffect.aperture.value=v.lerp(this.apertureMultiplier,32,i);const e=this.focusDistanceCutoff;t>e&&this.dofEffect.active?this.dofEffect.active=!1:t<e&&!this.dofEffect.active&&(this.dofEffect.active=!0)}}}kt([o()],bt.prototype,"apertureMultiplier",2);kt([o()],bt.prototype,"focalLength",2);kt([o()],bt.prototype,"focusDistanceCutoff",2);class wi extends c{constructor(){super(...arguments),this._previousEnvironmentTexture=null}onEnable(){this._previousEnvironmentTexture=this.context.scene.environment,this.context.scene.environment=null}onDisable(){this.context.scene.environment=this._previousEnvironmentTexture}}var vi=Object.defineProperty,_i=Object.getOwnPropertyDescriptor,Oi=(s,t,r,i)=>{for(var e=i>1?void 0:i?_i(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&vi(t,r,e),e};const yi=P("sample_debugParticlesOnClick");class Le extends c{constructor(){super(...arguments),this.particleSystems=[]}update(){if(!this.context.isInVR&&this.context.input.getPointerClicked(0)){const t=this.context.physics.raycast();t.length>0&&this.spawnParticlesAt(t[0].point)}}onUpdateXR(t){t.xr.controllers.forEach(r=>{var i,e;if(((i=r.getButton("primary"))==null?void 0:i.isDown)===!0){const n=(e=this.context.physics.raycastFromRay(r.ray))==null?void 0:e.at(0);n&&this.spawnParticlesAt(n.point)}})}spawnParticlesAt(t){ct(this.gameObject,t),yi&&E.DrawWireSphere(t,.5,16711680,1);for(const r of this.particleSystems)r&&(m.setActive(r.gameObject,!0),r.play())}}Oi([g(zt)],Le.prototype,"particleSystems",2);var Pi=Object.defineProperty,Ci=Object.getOwnPropertyDescriptor,ji=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ci(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Pi(t,r,e),e};class Fe extends c{constructor(){super(...arguments),this.parameters=[]}awake(){var t=!1;this.parameters.forEach(r=>{P(r)||(Rt(r,""),t=!0)}),t&&window.location.reload()}}ji([o()],Fe.prototype,"parameters",2);var Si=Object.defineProperty,Di=Object.getOwnPropertyDescriptor,Ne=(s,t,r,i)=>{for(var e=i>1?void 0:i?Di(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Si(t,r,e),e};class Bt extends c{constructor(){super(...arguments),this.htmlSelector="button.some-button",this.onClick=new b,this.onClicked=()=>{this.onClick.invoke()}}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}Ne([g()],Bt.prototype,"htmlSelector",2);Ne([o(b)],Bt.prototype,"onClick",2);var Mi=Object.defineProperty,Ti=Object.getOwnPropertyDescriptor,Ve=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ti(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Mi(t,r,e),e};class Xt extends c{constructor(){super(...arguments),this.createdElements=[]}onEnable(){var t;if(!(!this.methods||!this.names))for(let r=0;r<this.methods.length;r++){const i=this.methods[r];let e="Button";r<((t=this.names)==null?void 0:t.length)&&(e=this.names[r]);const n=document.createElement("button");n.innerHTML=e,n.onclick=()=>{i.invoke()},this.context.menu.appendChild(n),this.createdElements.push(n)}}onDisable(){for(const t of this.createdElements)t.remove()}reloadPageInSeconds(t){setTimeout(()=>{location.reload()},t*1e3)}}Ve([o(b)],Xt.prototype,"methods",2);Ve([o()],Xt.prototype,"names",2);var Ei=Object.defineProperty,$i=Object.getOwnPropertyDescriptor,xt=(s,t,r,i)=>{for(var e=i>1?void 0:i?$i(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Ei(t,r,e),e};class k extends c{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.rotate90=new At().setFromAxisAngle(new y(0,1,0),Math.PI)}start(){const t=P("url");t&&(this.url=t);const r=document.createElement("div");r.innerHTML='<iframe width="1000" height="1000" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr" allowfullscreen></iframe>',r.style.zIndex="10000",r.style.position="absolute",r.style.pointerEvents="initial";const i=r.querySelector("iframe");i.addEventListener("load",()=>{setTimeout(()=>{var h;console.log("Automatically opening iframe"),(h=this.animator)==null||h.SetBool("Open",!0)},1e3)}),i.src=this.url;let e=1e3;const n=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),a=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);e=Math.max(n,a),i.width=n+"px",i.height=a+"px",r.style.position="absolute",this.borderRadius>0&&(r.style.borderRadius=this.borderRadius+"px"),r.style.pointerEvents="initial",document.body.append(r),this.cssRenderer=new Zr,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new $r;const l=new kr(r);l.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/e),ct(l,Et(this.gameObject)),de(l,me(this.gameObject)),l.quaternion.multiply(this.rotate90),this.cssScene.add(l),this.cssObj=l,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;ct(this.cssObj,Et(this.gameObject)),de(this.cssObj,me(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const t=this.context.mainCamera,r=this.gameObject;var i=t.position.clone().sub(this.gameObject.position).normalize(),e=r.getWorldDirection(new y);const n=i.dot(e);this.cssObj.visible=n<.15;const a=this.cssRenderer.getSize();(a.width!==this.context.domWidth||a.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}}xt([g()],k.prototype,"url",2);xt([g()],k.prototype,"pixelsPerUnit",2);xt([g()],k.prototype,"borderRadius",2);xt([g(Ht)],k.prototype,"animator",2);class Ai extends c{constructor(){super(...arguments),this._ui=null,this._incubationsHint=null,this._components=[]}onEnable(){var e;(e=this._ui)==null||e.remove(),this._components=m.findObjectsOfType(dr);const t=document.createElement("div");t.style.cssText=`
            font-family: 'Roboto flex', Ariel;
            position: absolute;
            top: 1em;
            left: 1em;
            line-height: 1.5em;
            display: block;
            width: 200px;
        `,this.context.domElement.appendChild(t),this._ui=t;const r=document.createElement("h2");r.style.cssText=`
            margin-bottom: .7em;
        `,r.innerText="Sample Images",t.appendChild(r);const i=document.createElement("p");i.innerHTML=`Download the image and print it or you can also open the image in your browser
        <br><strong>Then enter AR and scan it with your camera.</strong>
        <br>Visit our <a target="_blank" href="https://docs.needle.tools/image-tracking">ImageTracking documentation</a> for more information.
        `,i.style.userSelect="all",t.appendChild(i);for(const n of this._components)this.createDownloadImageUI(n,t)}onDisable(){var t;(t=this._ui)==null||t.remove()}update(){var t;this.context.isInAR?(t=this._ui)==null||t.remove():this._ui&&!this._ui.parentNode&&this.context.domElement.appendChild(this._ui)}onUpdateXR(t){if(t.xr.frame&&!("getImageTrackingResults"in t.xr.frame)&&!this._incubationsHint&&this._ui&&x.isAndroidDevice()){const r=document.createElement("p");r.style.cssText=`
                    background: rgba(255, 100, 100, .7);
                    border-radius: .5rem;
                    padding: .4rem;
                `,r.innerText="WebXR ImageTracking is not enabled. Go to chrome://flags/#webxr-incubations and enable #webxr-incubations",this._ui.append(r),this._incubationsHint=r}}createDownloadImageUI(t,r){if(t.trackedImages)for(const i of t.trackedImages){if(!i.image)continue;const e=document.createElement("a");e.href=i.image,e.target="_blank",r.appendChild(e);const n=document.createElement("img");n.src=i.image,n.style.cssText=`
                min-width: 180px;
                max-width: 220px;
                width: 15vw;
                height: auto;
                aspect-ratio: 1.3;
                object-fit: cover;
                background: rgba(0,0,0,0.5);
                border-radius: 10px;
                border: 2px solid rgba(255,255,255,1);
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                margin-left: -.5em;
            `,e.appendChild(n)}}}var Ii=Object.defineProperty,Li=Object.getOwnPropertyDescriptor,Ue=(s,t,r,i)=>{for(var e=i>1?void 0:i?Li(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Ii(t,r,e),e};class Jt extends c{constructor(){super(...arguments),this.tempVec1=new y,this.tempVec2=new y}update(){if(!this.lodGroup||!this.text)return;const t=this.context.mainCamera;t.getWorldPosition(this.tempVec1),this.gameObject.getWorldPosition(this.tempVec2);const r=this.tempVec1.distanceTo(this.tempVec2)/t.zoom,i=this.lodGroup._lodsHandler;let e=null;i==null||i.forEach(n=>{var d,u;const a=n.levels[n.getCurrentLevel()],l=n.levels.at(n.getCurrentLevel()+1);let h=null;if(a.object instanceof Me){const S=a.object.geometry.attributes,N=Math.floor(((d=S.position)==null?void 0:d.count)||0);h=`Triangles: ${Math.floor((((u=S.index)==null?void 0:u.count)||N)/3)}, Vertices: ${N}`}a.object.name.replace(/_/g,""),a.object.name.includes("Cull")||(e="",h&&(e+=`${h}
`),l==null||l.hysteresis,e+=`${a.distance.toFixed(1)} / ${r.toFixed(1)}`,l&&(e+=` / ${(l.distance-l.distance*l.hysteresis).toFixed(1)}`))}),e||(e="culled"),this.text.text=e}}Ue([o(mr)],Jt.prototype,"lodGroup",2);Ue([o(Y)],Jt.prototype,"text",2);var Fi=Object.defineProperty,Ni=Object.getOwnPropertyDescriptor,te=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ni(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Fi(t,r,e),e};class It extends c{onColorChanged(){typeof this.color=="number"&&(this.color=new pt(this.color)),this.setColorToMaterials()}onPointerClick(t){const r=new pt(Math.random(),Math.random(),Math.random());this.color=r}onEnable(){f("<strong>Click an object</strong> to change the color. Open this window in another browser tab/window to see the networking in action..."),this.setColorToMaterials()}setColorToMaterials(){var r;const t=this.gameObject.getComponent(O);if(t)for(let i=0;i<t.sharedMaterials.length;i++){const e=(r=t.sharedMaterials[i])==null?void 0:r.clone();t.sharedMaterials[i]=e,e&&"color"in e&&(e.color=this.color)}else console.warn("No renderer found",this.gameObject)}}te([I(It.prototype.onColorChanged),o(pt)],It.prototype,"color",2);class Lt extends c{constructor(){super(...arguments),this.myArray=[],this.updateArray=()=>{const t=new Date().toLocaleTimeString();console.log("> Update array",t),this.myArray.length>10&&(console.log("Clearing array because we have reached 10 entries"),this.myArray.length=0),this.myArray.push(t),this.myArray=this.myArray,f(`<strong>> Send</strong> "${t}", ${this.myArray.length} elements`)}}onArrayChanged(){console.log("< Received array",this.myArray[this.myArray.length-1],this.myArray),f(`<strong>< Received</strong> "${this.myArray[this.myArray.length-1]}", we now have ${this.myArray.length} elements`)}start(){f("Open this window in another browser tab/window to see the networking in action..."),setInterval(this.updateArray,4e3)}}te([I(Lt.prototype.onArrayChanged)],Lt.prototype,"myArray",2);class Vi{constructor(){this.name="",this.age=0}}class Ft extends c{constructor(){super(...arguments),this.myObject=new Vi,this.updateObject=()=>{this.myObject.name=this.context.connection.connectionId,this.myObject.age+=1,this.myObject=this.myObject,console.log("> Updated",this.myObject),f('<strong>> Sent</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}onObjectChanged(){console.log("< Received object",this.myObject),f(`<strong>< Received</strong> "${this.myObject.name}" is ${this.myObject.age} years old`)}awake(){f("Open this window in another browser tab/window to see the networking in action..."),setInterval(this.updateObject,5e3)}}te([I(Ft.prototype.onObjectChanged)],Ft.prototype,"myObject",2);var Ui=Object.defineProperty,Wi=Object.getOwnPropertyDescriptor,We=(s,t,r,i)=>{for(var e=i>1?void 0:i?Wi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Ui(t,r,e),e};class ee extends c{constructor(){super(...arguments),this.clampFrameRate=!0,this._clampFrameRate=!1,this.maxFrameRate=72,this._maxFrameRate=-1024}update(){if(this._clampFrameRate!==this.clampFrameRate||this._maxFrameRate!==this.maxFrameRate){const t=this.clampFrameRate?this.maxFrameRate:void 0;this.context.targetFrameRate=t,this._clampFrameRate=this.clampFrameRate,this._maxFrameRate=this.maxFrameRate}}setTarget(t){this.maxFrameRate=t,this.clampFrameRate=!0}setClamping(t){this.clampFrameRate=t}}We([o()],ee.prototype,"clampFrameRate",2);We([o()],ee.prototype,"maxFrameRate",2);var zi=Object.defineProperty,Ri=Object.getOwnPropertyDescriptor,wt=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ri(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&zi(t,r,e),e};class B extends c{constructor(){super(...arguments),this.width=1024,this.height=1024,this.prefab=null}takePhoto(){const t=ur({type:"texture",camera:this.camera,width:this.width,height:this.height});this.prefab&&t instanceof Ar&&this.prefab.instantiate(this.scene).then(r=>{if(!r)return;setTimeout(()=>{r.destroy()},2e3),r==null||r.position.set(0,3,0),r==null||r.getOrAddComponent(fr);const i=r==null?void 0:r.getComponentInChildren(D);i&&(i.teleport(this.gameObject.worldPosition.add({x:0,y:.5,z:0})),i.setAngularVelocity(Math.random()-.5,Math.random()-.5,Math.random()*2-1),i.applyImpulse(this.gameObject.worldForward.add({x:0,y:2,z:0}).normalize().multiplyScalar(.01)));const e=r==null?void 0:r.getComponentInChildren(O);if(e){const n=e.sharedMaterial.clone()||new De;n&&"map"in n&&(n.map=t,n.side=Ir),e.sharedMaterial=n}})}}wt([o(ve)],B.prototype,"camera",2);wt([o()],B.prototype,"width",2);wt([o()],B.prototype,"height",2);wt([o(Oe)],B.prototype,"prefab",2);var Hi=Object.defineProperty,Gi=Object.getOwnPropertyDescriptor,L=(s,t,r,i)=>{for(var e=i>1?void 0:i?Gi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Hi(t,r,e),e};class X extends c{constructor(){super(...arguments),this.logEvents=!1}onCollisionEnter(t){var r;this.logEvents&&console.log("ENTER",t),(r=this.onEnter)==null||r.invoke(t)}onCollisionStay(t){var r;this.logEvents&&console.log("STAY",t),(r=this.onStay)==null||r.invoke(t)}onCollisionExit(t){var r;this.logEvents&&console.log("EXIT",t),(r=this.onExit)==null||r.invoke(t)}}L([g(b)],X.prototype,"onEnter",2);L([g(b)],X.prototype,"onStay",2);L([g(b)],X.prototype,"onExit",2);L([g()],X.prototype,"logEvents",2);class J extends c{onTriggerEnter(t){var r,i;this.triggerObjects&&this.triggerObjects.length>0&&!((r=this.triggerObjects)!=null&&r.includes(t.gameObject))||(i=this.onEnter)==null||i.invoke()}onTriggerStay(t){var r,i;this.triggerObjects&&this.triggerObjects.length>0&&!((r=this.triggerObjects)!=null&&r.includes(t.gameObject))||(i=this.onStay)==null||i.invoke()}onTriggerExit(t){var r,i;this.triggerObjects&&this.triggerObjects.length>0&&!((r=this.triggerObjects)!=null&&r.includes(t.gameObject))||(i=this.onExit)==null||i.invoke()}}L([g(m)],J.prototype,"triggerObjects",2);L([g(b)],J.prototype,"onEnter",2);L([g(b)],J.prototype,"onStay",2);L([g(b)],J.prototype,"onExit",2);var qi=Object.defineProperty,Qi=Object.getOwnPropertyDescriptor,Ki=(s,t,r,i)=>{for(var e=i>1?void 0:i?Qi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&qi(t,r,e),e};class ze extends c{constructor(){super(...arguments),this._lastTriggerTime=0}onTriggerEnter(t){this.context.time.time-this._lastTriggerTime<.3||(this._lastTriggerTime=this.context.time.time,this.animation&&this.animation.play(0,{loop:!1}))}onTriggerExit(){}}Ki([g(dt)],ze.prototype,"animation",2);var Yi=Object.defineProperty,Zi=Object.getOwnPropertyDescriptor,ki=(s,t,r,i)=>{for(var e=i>1?void 0:i?Zi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Yi(t,r,e),e};class Re extends c{onTriggerEnter(){var t,r;(t=this.animation)!=null&&t.isPlaying||(r=this.animation)==null||r.play(0,{loop:!1})}}ki([g(dt)],Re.prototype,"animation",2);var Bi=Object.defineProperty,Xi=Object.getOwnPropertyDescriptor,Ji=(s,t,r,i)=>{for(var e=i>1?void 0:i?Xi(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Bi(t,r,e),e};class He extends c{onCollisionEnter(){var t,r;(t=this.audioSource)==null||t.stop(),(r=this.audioSource)==null||r.play()}}Ji([g(U)],He.prototype,"audioSource",2);class ts extends c{onEnable(){const t=m.findObjectOfType(Gt);t==null||t.addEventListener("before-export",()=>{this.resetAnimations()})}onEnterXR(t){this.resetAnimations()}resetAnimations(){console.warn("Resetting animations and audio for XR export.");const t=m.findObjectsOfType(dt);for(const i of t)i.actions.forEach(e=>{e.reset(),e.time=0,e.play()});const r=m.findObjectsOfType(U);for(const i of r)i.stop(),i.play()}}var es=Object.defineProperty,rs=Object.getOwnPropertyDescriptor,Ge=(s,t,r,i)=>{for(var e=i>1?void 0:i?rs(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&es(t,r,e),e};class re extends c{constructor(){super(...arguments),this.referenceSize=512,this.updateSize=()=>{if(this.content){if(this.referenceSize<=0)return console.error("ResponsiveContent: Base width must be greater than 0.");const t=this.context.domWidth/this.referenceSize;this.content.scale.set(t,t,t)}else K()&&console.warn("ResponsiveContent: No content object set.")}}onEnable(){window.addEventListener("resize",this.updateSize),this.updateSize()}onDisable(){window.removeEventListener("resize",this.updateSize)}}Ge([o(C)],re.prototype,"content",2);Ge([o()],re.prototype,"referenceSize",2);var is=Object.defineProperty,ss=Object.getOwnPropertyDescriptor,ie=(s,t,r,i)=>{for(var e=i>1?void 0:i?ss(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&is(t,r,e),e};class qe extends c{async sceneOpened(){var t;(t=this.animator)==null||t.setBool("SceneOpen",!0),this._htmlElement=this._getHtmlElement(),this.context.domElement.appendChild(this._htmlElement)}async sceneClosing(){var t,r;await $t(1e3),(t=this.animator)==null||t.setBool("SceneOpen",!1),await $t(1e3),(r=this._htmlElement)==null||r.remove()}_getHtmlElement(){if(!this._htmlElement){this._htmlElement=document.createElement("div"),this._htmlElement.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                // backdrop-filter: blur(10px);
            `;const t=document.createElement("img");t.src="https://engine.needle.tools/branding/needle-logo.png",this._htmlElement.appendChild(t)}return this._htmlElement}}ie([o(Ht)],qe.prototype,"animator",2);class se extends c{sceneOpened(){var t;return K()&&console.log("Scene opened",this.name),(t=this.opened)==null||t.invoke(),Promise.resolve()}sceneClosing(){var t;return K()&&console.log("Scene closing",this.name),(t=this.closing)==null||t.invoke(),Promise.resolve()}}ie([o(b)],se.prototype,"opened",2);ie([o(b)],se.prototype,"closing",2);class ns extends c{next(){var t;this.switcher??(this.switcher=this.get()),console.log(this.switcher),(t=this.switcher)==null||t.selectNext()}previous(){var t;this.switcher??(this.switcher=this.get()),(t=this.switcher)==null||t.selectPrev()}get(){return m.findObjectOfType(gr)}}class as extends c{awake(){const t=this.gameObject.getComponent(O);if(t!=null&&t.sharedMaterials)for(const r of t.sharedMaterials)r&&(r.side=Lr)}}var os=Object.defineProperty,ls=Object.getOwnPropertyDescriptor,hs=(s,t,r,i)=>{for(var e=i>1?void 0:i?ls(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&os(t,r,e),e};class Qe extends c{constructor(){super(...arguments),this.text=""}start(){f(this.text)}}hs([o()],Qe.prototype,"text",2);var cs=Object.defineProperty,ps=Object.getOwnPropertyDescriptor,ds=(s,t,r,i)=>{for(var e=i>1?void 0:i?ps(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&cs(t,r,e),e};const ms=P("testleaderboard");class Nt extends c{constructor(){super(...arguments),this._ready=!1}get ready(){return this._ready}onEnable(){this.context.connection.beginListen(br.JoinedRoom,async()=>{await $t(100),this.context.connection.tryGetState(this.guid)||(this.data={scores:[]}),this._ready=!0}),ms?(console.log("Enabled test leaderboard, adding random scores"),setInterval(()=>{this.insertScore("Player",Math.floor(Math.random()*1e3))},2e3)):K()&&f("You can add ?testleaderboard to the url to test the leaderboard")}insertScore(t,r){if(!this._ready){console.warn("Cannot insert score, data not received yet");return}const i=10,e=this.data.scores;for(;e.length>=i;){this.sortScores();const n=e.pop();if(n.score>r){console.log(`Score ${r} is lower than ${n==null?void 0:n.score} (lowest score), ignoring`),e.push(n);return}}console.log("Inserting score",t,r),e.push({name:t,score:r}),this.sortScores(),this.data=this.data}sortScores(){this.data.scores.sort((t,r)=>r.score-t.score)}onDataChanged(t){if(console.warn("Data changed!",t,this.data.scores),this.data.scores.length>0){const r=this.data.scores[0];f("HIGHSCORE - "+r.name+": "+r.score)}this.dispatchEvent(new CustomEvent("changed",{detail:this.data}))}}ds([I(Nt.prototype.onDataChanged)],Nt.prototype,"data",2);var us=Object.defineProperty,fs=Object.getOwnPropertyDescriptor,gs=(s,t,r,i)=>{for(var e=i>1?void 0:i?fs(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&us(t,r,e),e};class Ke extends c{start(){this.updateStartPosition();const t=m.findObjectOfType(Gt);t&&t.addEventListener("before-export",()=>{this.resetToStart()})}updateStartPosition(){this.gameObject.updateMatrix(),this.startPosition=this.gameObject.position.clone(),this.startMatrix=this.gameObject.matrix.clone()}resetToStart(){if(!this.startPosition)return;const t=m.getComponent(this.gameObject,D);t==null||t.teleport(this.startPosition)}}class Ye extends Ke{start(){super.start(),this.worldCollider||console.warn("Missing collider to reset",this)}onTriggerExit(t){t===this.worldCollider&&this.resetToStart()}createBehaviours(t,r,i){if(r.uuid!==this.gameObject.uuid||!this.startPosition||!this.startMatrix)return;const e=ht.createEmpty();this.gameObject.parent?e.matrix=this.gameObject.parent.matrixWorld.clone().multiply(this.startMatrix):e.matrix=this.startMatrix,i.document.add(e);const n=new $("_reset_"+this.name+"_afterTime",A.sceneStartTrigger(),_.sequence(_.waitAction(Math.random()*4+1),_.sequence(_.transformAction(this.gameObject,e,0,"absolute","none"),_.waitAction(5)).makeLooping())).makeExclusive(!0);t.addBehavior(n)}}gs([g(mt)],Ye.prototype,"worldCollider",2);var bs=Object.defineProperty,xs=Object.getOwnPropertyDescriptor,ws=(s,t,r,i)=>{for(var e=i>1?void 0:i?xs(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&bs(t,r,e),e};class Ze extends c{constructor(){super(...arguments),this.roomId="",this.playerCount=0}update(){const t=this.context.connection;let r=!1;t.currentRoomName&&t.currentRoomName!==this.roomId&&(this.roomId=t.currentRoomName,r=!0),t.usersInRoom().length!==this.playerCount&&(this.playerCount=t.usersInRoom().length,r=!0),r&&this.connectionLabel&&(this.connectionLabel.text=`Room: ${this.roomId}
Users: ${this.playerCount}
Your id: ${t.connectionId}`)}}ws([o(Y)],Ze.prototype,"connectionLabel",2);var vs=Object.defineProperty,_s=Object.getOwnPropertyDescriptor,Os=(s,t,r,i)=>{for(var e=i>1?void 0:i?_s(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&vs(t,r,e),e};class ke extends c{constructor(){super(...arguments),this.interval=1e3,this.max=100,this.spawned=0}awake(){if(!this.object){console.warn("TimedSpawn: no object to spawn"),f("TimedSpawn: no object to spawn",ye.Warn);return}m.setActive(this.object,!1),this.startCoroutine(this.spawn())}*spawn(){if(this.object)for(;this.spawned<this.max;){const t=m.instantiate(this.object);m.setActive(t,!0),this.spawned+=1,yield xr(this.interval/1e3)}}}Os([g(m)],ke.prototype,"object",2);var ys=Object.defineProperty,Ps=Object.getOwnPropertyDescriptor,Cs=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ps(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&ys(t,r,e),e};class Be extends c{constructor(){super(...arguments),this.onlyMobile=!1}awake(){if(this.onlyMobile&&!wr())return;const t=this.gameObject.getComponent(vr);t&&(t.position="top")}}Cs([o()],Be.prototype,"onlyMobile",2);class js extends c{constructor(){super(...arguments),this._video=null}async onEnable(){this._video??(this._video=document.createElement("video")),this._video.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            object-fit: cover;
        `,this.context.domElement.shadowRoot.appendChild(this._video);const t=await navigator.mediaDevices.getUserMedia({video:!0});!t||!this.enabled||(this._video.srcObject=t,this._video.play())}onDisable(){var t,r;(t=this._video)==null||t.pause(),(r=this._video)==null||r.remove()}}var Ss=Object.defineProperty,Ds=Object.getOwnPropertyDescriptor,vt=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ds(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Ss(t,r,e),e};class tt extends c{constructor(){super(...arguments),this.interval=3,this.resetPosition=!0,this.resetRotation=!1,this.resetVelocity=!1}start(){const t=this.gameObject.position.clone(),r=this.gameObject.rotation.clone(),i=this.gameObject.getComponent(D),e=this.context.time.frame;setInterval(()=>{this.resetPosition&&this.gameObject.position.copy(t),this.resetRotation&&this.gameObject.rotation.copy(r),i&&this.resetVelocity&&this.context.time.frame!==e&&i.resetVelocities()},this.interval*1e3)}}vt([o()],tt.prototype,"interval",2);vt([o()],tt.prototype,"resetPosition",2);vt([o()],tt.prototype,"resetRotation",2);vt([o()],tt.prototype,"resetVelocity",2);class Ms extends c{constructor(){super(...arguments),this.toggleRendererOnly=!1}start(){setInterval(()=>{if(f('This is a sample for showing how to <a href="https://engine.needle.tools/docs/scripting.html#component-architecture" target="_blank">toggle visibility of a GameObject</a>'),this.toggleRendererOnly){const t=this.gameObject.getComponent(O);t&&(t.enabled=!t.enabled)}else this.gameObject.visible=!this.gameObject.visible},1e3)}}var Ts=Object.defineProperty,Es=Object.getOwnPropertyDescriptor,$s=(s,t,r,i)=>{for(var e=i>1?void 0:i?Es(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Ts(t,r,e),e};class Xe extends c{awake(){this.material&&(this.material.wireframe=!0)}}$s([o(Qt)],Xe.prototype,"material",2);var As=Object.defineProperty,Is=Object.getOwnPropertyDescriptor,Je=(s,t,r,i)=>{for(var e=i>1?void 0:i?Is(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&As(t,r,e),e};class ne extends c{constructor(){super(...arguments),this.onSessionStart=new b,this.onSessionEnd=new b}onEnterXR(t){this.onWebXRStarted()}onExitXR(t){this.onWebXREnded()}onWebXRStarted(){this.onSessionStart.invoke()}onWebXREnded(){this.onSessionEnd.invoke()}}Je([o(b)],ne.prototype,"onSessionStart",2);Je([o(b)],ne.prototype,"onSessionEnd",2);const lt=P("debugbodytracking");class Ls extends c{constructor(){super(...arguments),this.jointPositions=new Map,this.size=new y(.01,.01,.01),this.hasWarnedForName=new Set}onEnable(){lt&&console.log(xe.join(`
`))}onBeforeXR(t,r){r.optionalFeatures=r.optionalFeatures||[],r.optionalFeatures.includes("body-tracking")||r.optionalFeatures.push("body-tracking")}onUpdateXR(t){const r=t.xr.frame;if(!r)return;const i=t.xr.rig.gameObject,e=this.context.renderer.xr.getReferenceSpace();if(r.session&&"body"in r&&e){const n=r.body;if(!n)return;n.forEach(a=>{const l=r.getPose(a,e);if(!l)return;const h=l.transform.position,d=w();d.copy(h),d.x*=-1,d.z*=-1,i.localToWorld(d);const u=a.jointName;this.jointPositions.has(u)||this.jointPositions.set(u,new y),this.jointPositions.get(u).copy(d),lt&&E.DrawWireBox(d,this.size,16711680,void 0,!1);const S=w();S.copy(h),S.x*=-1,i.localToWorld(S);const N=a.jointName+"-flipped";this.jointPositions.has(N)||this.jointPositions.set(N,new y),this.jointPositions.get(N).copy(S),lt&&E.DrawWireBox(S,this.size,65280,void 0,!1);const ot=xe.indexOf(u);lt&&E.DrawLabel(S,ot.toString(),.015,void 0,16777215,85),ot<0&&(this.hasWarnedForName.has(u)||(this.hasWarnedForName.add(u),console.warn("Wrong name: "+u+" -> "+ot+". Please report a bug.")))});for(const a of Fs){const l=this.jointPositions.get(a.from),h=this.jointPositions.get(a.to);if(l&&h){E.DrawLine(l,h,16776960,void 0,!1);const d=this.jointPositions.get(a.from+"-flipped"),u=this.jointPositions.get(a.to+"-flipped");d&&u&&E.DrawLine(d,u,65535,void 0,!1)}}}}}var tr=(s=>(s[s.root=0]="root",s[s.hips=1]="hips",s[s["spine-lower"]=2]="spine-lower",s[s["spine-middle"]=3]="spine-middle",s[s["spine-upper"]=4]="spine-upper",s[s.chest=5]="chest",s[s.neck=6]="neck",s[s.head=7]="head",s[s["left-shoulder"]=8]="left-shoulder",s[s["left-scapula"]=9]="left-scapula",s[s["left-arm-upper"]=10]="left-arm-upper",s[s["left-arm-lower"]=11]="left-arm-lower",s[s["left-hand-wrist-twist"]=12]="left-hand-wrist-twist",s[s["right-shoulder"]=13]="right-shoulder",s[s["right-scapula"]=14]="right-scapula",s[s["right-arm-upper"]=15]="right-arm-upper",s[s["right-arm-lower"]=16]="right-arm-lower",s[s["right-hand-wrist-twist"]=17]="right-hand-wrist-twist",s[s["left-hand-palm"]=18]="left-hand-palm",s[s["left-hand-wrist"]=19]="left-hand-wrist",s[s["left-hand-thumb-metacarpal"]=20]="left-hand-thumb-metacarpal",s[s["left-hand-thumb-phalanx-proximal"]=21]="left-hand-thumb-phalanx-proximal",s[s["left-hand-thumb-phalanx-distal"]=22]="left-hand-thumb-phalanx-distal",s[s["left-hand-thumb-tip"]=23]="left-hand-thumb-tip",s[s["left-hand-index-metacarpal"]=24]="left-hand-index-metacarpal",s[s["left-hand-index-phalanx-proximal"]=25]="left-hand-index-phalanx-proximal",s[s["left-hand-index-phalanx-intermediate"]=26]="left-hand-index-phalanx-intermediate",s[s["left-hand-index-phalanx-distal"]=27]="left-hand-index-phalanx-distal",s[s["left-hand-index-tip"]=28]="left-hand-index-tip",s[s["left-hand-middle-phalanx-metacarpal"]=29]="left-hand-middle-phalanx-metacarpal",s[s["left-hand-middle-phalanx-proximal"]=30]="left-hand-middle-phalanx-proximal",s[s["left-hand-middle-phalanx-intermediate"]=31]="left-hand-middle-phalanx-intermediate",s[s["left-hand-middle-phalanx-distal"]=32]="left-hand-middle-phalanx-distal",s[s["left-hand-middle-tip"]=33]="left-hand-middle-tip",s[s["left-hand-ring-metacarpal"]=34]="left-hand-ring-metacarpal",s[s["left-hand-ring-phalanx-proximal"]=35]="left-hand-ring-phalanx-proximal",s[s["left-hand-ring-phalanx-intermediate"]=36]="left-hand-ring-phalanx-intermediate",s[s["left-hand-ring-phalanx-distal"]=37]="left-hand-ring-phalanx-distal",s[s["left-hand-ring-tip"]=38]="left-hand-ring-tip",s[s["left-hand-little-metacarpal"]=39]="left-hand-little-metacarpal",s[s["left-hand-little-phalanx-proximal"]=40]="left-hand-little-phalanx-proximal",s[s["left-hand-little-phalanx-intermediate"]=41]="left-hand-little-phalanx-intermediate",s[s["left-hand-little-phalanx-distal"]=42]="left-hand-little-phalanx-distal",s[s["left-hand-little-tip"]=43]="left-hand-little-tip",s[s["right-hand-palm"]=44]="right-hand-palm",s[s["right-hand-wrist"]=45]="right-hand-wrist",s[s["right-hand-thumb-metacarpal"]=46]="right-hand-thumb-metacarpal",s[s["right-hand-thumb-phalanx-proximal"]=47]="right-hand-thumb-phalanx-proximal",s[s["right-hand-thumb-phalanx-distal"]=48]="right-hand-thumb-phalanx-distal",s[s["right-hand-thumb-tip"]=49]="right-hand-thumb-tip",s[s["right-hand-index-metacarpal"]=50]="right-hand-index-metacarpal",s[s["right-hand-index-phalanx-proximal"]=51]="right-hand-index-phalanx-proximal",s[s["right-hand-index-phalanx-intermediate"]=52]="right-hand-index-phalanx-intermediate",s[s["right-hand-index-phalanx-distal"]=53]="right-hand-index-phalanx-distal",s[s["right-hand-index-tip"]=54]="right-hand-index-tip",s[s["right-hand-middle-metacarpal"]=55]="right-hand-middle-metacarpal",s[s["right-hand-middle-phalanx-proximal"]=56]="right-hand-middle-phalanx-proximal",s[s["right-hand-middle-phalanx-intermediate"]=57]="right-hand-middle-phalanx-intermediate",s[s["right-hand-middle-phalanx-distal"]=58]="right-hand-middle-phalanx-distal",s[s["right-hand-middle-tip"]=59]="right-hand-middle-tip",s[s["right-hand-ring-metacarpal"]=60]="right-hand-ring-metacarpal",s[s["right-hand-ring-phalanx-proximal"]=61]="right-hand-ring-phalanx-proximal",s[s["right-hand-ring-phalanx-intermediate"]=62]="right-hand-ring-phalanx-intermediate",s[s["right-hand-ring-phalanx-distal"]=63]="right-hand-ring-phalanx-distal",s[s["right-hand-ring-tip"]=64]="right-hand-ring-tip",s[s["right-hand-little-metacarpal"]=65]="right-hand-little-metacarpal",s[s["right-hand-little-phalanx-proximal"]=66]="right-hand-little-phalanx-proximal",s[s["right-hand-little-phalanx-intermediate"]=67]="right-hand-little-phalanx-intermediate",s[s["right-hand-little-phalanx-distal"]=68]="right-hand-little-phalanx-distal",s[s["right-hand-little-tip"]=69]="right-hand-little-tip",s[s["left-upper-leg"]=70]="left-upper-leg",s[s["left-lower-leg"]=71]="left-lower-leg",s[s["left-foot-ankle-twist"]=72]="left-foot-ankle-twist",s[s["left-foot-ankle"]=73]="left-foot-ankle",s[s["left-foot-subtalar"]=74]="left-foot-subtalar",s[s["left-foot-transverse"]=75]="left-foot-transverse",s[s["left-foot-ball"]=76]="left-foot-ball",s[s["right-upper-leg"]=77]="right-upper-leg",s[s["right-lower-leg"]=78]="right-lower-leg",s[s["right-foot-ankle-twist"]=79]="right-foot-ankle-twist",s[s["right-foot-ankle"]=80]="right-foot-ankle",s[s["right-foot-subtalar"]=81]="right-foot-subtalar",s[s["right-foot-transverse"]=82]="right-foot-transverse",s[s["right-foot-ball"]=83]="right-foot-ball",s))(tr||{});const xe=Object.values(tr),Fs=[{from:"hips",to:"spine-lower"},{from:"spine-lower",to:"spine-middle"},{from:"spine-middle",to:"spine-upper"},{from:"spine-upper",to:"chest"},{from:"chest",to:"neck"},{from:"neck",to:"head"},{from:"chest",to:"left-shoulder"},{from:"left-shoulder",to:"left-scapula"},{from:"left-scapula",to:"left-arm-upper"},{from:"left-arm-upper",to:"left-arm-lower"},{from:"left-arm-lower",to:"left-hand-wrist-twist"},{from:"left-hand-wrist-twist",to:"left-hand-wrist"},{from:"left-hand-wrist",to:"left-hand-palm"},{from:"left-hand-wrist",to:"left-hand-thumb-metacarpal"},{from:"left-hand-thumb-metacarpal",to:"left-hand-thumb-phalanx-proximal"},{from:"left-hand-thumb-phalanx-proximal",to:"left-hand-thumb-phalanx-distal"},{from:"left-hand-thumb-phalanx-distal",to:"left-hand-thumb-tip"},{from:"left-hand-wrist",to:"left-hand-index-metacarpal"},{from:"left-hand-index-metacarpal",to:"left-hand-index-phalanx-proximal"},{from:"left-hand-index-phalanx-proximal",to:"left-hand-index-phalanx-intermediate"},{from:"left-hand-index-phalanx-intermediate",to:"left-hand-index-phalanx-distal"},{from:"left-hand-index-phalanx-distal",to:"left-hand-index-tip"},{from:"left-hand-wrist",to:"left-hand-middle-phalanx-metacarpal"},{from:"left-hand-middle-phalanx-metacarpal",to:"left-hand-middle-phalanx-proximal"},{from:"left-hand-middle-phalanx-proximal",to:"left-hand-middle-phalanx-intermediate"},{from:"left-hand-middle-phalanx-intermediate",to:"left-hand-middle-phalanx-distal"},{from:"left-hand-middle-phalanx-distal",to:"left-hand-middle-tip"},{from:"left-hand-wrist",to:"left-hand-ring-metacarpal"},{from:"left-hand-ring-metacarpal",to:"left-hand-ring-phalanx-proximal"},{from:"left-hand-ring-phalanx-proximal",to:"left-hand-ring-phalanx-intermediate"},{from:"left-hand-ring-phalanx-intermediate",to:"left-hand-ring-phalanx-distal"},{from:"left-hand-ring-phalanx-distal",to:"left-hand-ring-tip"},{from:"left-hand-wrist",to:"left-hand-little-metacarpal"},{from:"left-hand-little-metacarpal",to:"left-hand-little-phalanx-proximal"},{from:"left-hand-little-phalanx-proximal",to:"left-hand-little-phalanx-intermediate"},{from:"left-hand-little-phalanx-intermediate",to:"left-hand-little-phalanx-distal"},{from:"left-hand-little-phalanx-distal",to:"left-hand-little-tip"},{from:"chest",to:"right-shoulder"},{from:"right-shoulder",to:"right-scapula"},{from:"right-scapula",to:"right-arm-upper"},{from:"right-arm-upper",to:"right-arm-lower"},{from:"right-arm-lower",to:"right-hand-wrist-twist"},{from:"right-hand-wrist-twist",to:"right-hand-wrist"},{from:"right-hand-wrist",to:"right-hand-palm"},{from:"right-hand-wrist",to:"right-hand-thumb-metacarpal"},{from:"right-hand-thumb-metacarpal",to:"right-hand-thumb-phalanx-proximal"},{from:"right-hand-thumb-phalanx-proximal",to:"right-hand-thumb-phalanx-distal"},{from:"right-hand-thumb-phalanx-distal",to:"right-hand-thumb-tip"},{from:"right-hand-wrist",to:"right-hand-index-metacarpal"},{from:"right-hand-index-metacarpal",to:"right-hand-index-phalanx-proximal"},{from:"right-hand-index-phalanx-proximal",to:"right-hand-index-phalanx-intermediate"},{from:"right-hand-index-phalanx-intermediate",to:"right-hand-index-phalanx-distal"},{from:"right-hand-index-phalanx-distal",to:"right-hand-index-tip"},{from:"right-hand-wrist",to:"right-hand-middle-metacarpal"},{from:"right-hand-middle-metacarpal",to:"right-hand-middle-phalanx-proximal"},{from:"right-hand-middle-phalanx-proximal",to:"right-hand-middle-phalanx-intermediate"},{from:"right-hand-middle-phalanx-intermediate",to:"right-hand-middle-phalanx-distal"},{from:"right-hand-middle-phalanx-distal",to:"right-hand-middle-tip"},{from:"right-hand-wrist",to:"right-hand-ring-metacarpal"},{from:"right-hand-ring-metacarpal",to:"right-hand-ring-phalanx-proximal"},{from:"right-hand-ring-phalanx-proximal",to:"right-hand-ring-phalanx-intermediate"},{from:"right-hand-ring-phalanx-intermediate",to:"right-hand-ring-phalanx-distal"},{from:"right-hand-ring-phalanx-distal",to:"right-hand-ring-tip"},{from:"right-hand-wrist",to:"right-hand-little-metacarpal"},{from:"right-hand-little-metacarpal",to:"right-hand-little-phalanx-proximal"},{from:"right-hand-little-phalanx-proximal",to:"right-hand-little-phalanx-intermediate"},{from:"right-hand-little-phalanx-intermediate",to:"right-hand-little-phalanx-distal"},{from:"right-hand-little-phalanx-distal",to:"right-hand-little-tip"},{from:"hips",to:"left-upper-leg"},{from:"left-upper-leg",to:"left-lower-leg"},{from:"left-lower-leg",to:"left-foot-ankle-twist"},{from:"left-foot-ankle-twist",to:"left-foot-ankle"},{from:"left-foot-ankle",to:"left-foot-subtalar"},{from:"left-foot-subtalar",to:"left-foot-transverse"},{from:"left-foot-transverse",to:"left-foot-ball"},{from:"hips",to:"right-upper-leg"},{from:"right-upper-leg",to:"right-lower-leg"},{from:"right-lower-leg",to:"right-foot-ankle-twist"},{from:"right-foot-ankle-twist",to:"right-foot-ankle"},{from:"right-foot-ankle",to:"right-foot-subtalar"},{from:"right-foot-subtalar",to:"right-foot-transverse"},{from:"right-foot-transverse",to:"right-foot-ball"}];var Ns=Object.defineProperty,Vs=Object.getOwnPropertyDescriptor,Us=(s,t,r,i)=>{for(var e=i>1?void 0:i?Vs(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Ns(t,r,e),e};class ae extends c{constructor(){super(...arguments),this.destroyTarget=!1,this._startTime=0}awake(){if(this._rigidbody=this.gameObject.getComponentInParent(D)||void 0,this._rigidbody){const t=this.gameObject.getComponentsInChildren(mt);for(const r of t){const i=m.addComponent(r.gameObject,Ws);i.rigidBody=this._rigidbody,i.arrow=this,i.audioOnImpact=this.audioOnImpact,i.destroyTarget=this.destroyTarget}}this._startTime=this.context.time.time}onBeforeRender(){if(this.context.time.time-this._startTime>5){this.gameObject.destroy();return}if(this._rigidbody){const t=this._rigidbody.getVelocity();if(t.lengthSq()>0){const r=w().set(t.x,t.y,t.z).normalize(),i=_r();i.setFromUnitVectors(w(0,0,1),r),this.gameObject.quaternion.copy(i)}}}}Us([o(U)],ae.prototype,"audioOnImpact",2);class Ws extends c{constructor(){super(...arguments),this.destroyTarget=!1}onCollisionEnter(t){var r,i;if(this.arrow)if((r=this.audioOnImpact)==null||r.stop(),(i=this.audioOnImpact)==null||i.play(),this.destroyTarget)t.gameObject.destroy(),this.arrow.gameObject.destroy();else{t.gameObject.attach(this.arrow.gameObject),t.rigidBody instanceof D&&t.rigidBody.applyImpulse(t.gameObject.position.clone().multiply(this.rigidBody.getVelocity()),!0);const e=this.rigidBody.gameObject.getComponentsInChildren(mt);for(const n of e)n.destroy();this.rigidBody.destroy(),this.arrow.destroy()}}}var zs=Object.defineProperty,Rs=Object.getOwnPropertyDescriptor,M=(s,t,r,i)=>{for(var e=i>1?void 0:i?Rs(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&zs(t,r,e),e};const we=P("debugarrow");class j extends c{constructor(){super(...arguments),this.power=1.5,this.drawMaxPhysicalDistance=.47269,this.drawMinPhysicalDistance=.1132593,this._tempLookMatrix=new Fr,this._tempLookRot=new At,this._lastShotTimestamp=Number.MIN_SAFE_INTEGER,this._isAiming=!1,this._bowController=void 0,this._stringController=void 0,this._controllerFollow=null,this._aimingPointerStartPos=new y,this._initialBowObjectRotation=new At,this._initialBowObjectPosition=new y,this._screenDragRaycaster=new Nr,this._screenDragPlane=new Vr,this._screenDragRayLine=new Ur,this.onDown=t=>{t.origin instanceof ue?t.button===0&&(this._bowController===void 0?(this._bowController=t.origin.index,this.bowObject.quaternion.copy(this._initialBowObjectRotation)):this._stringController===void 0&&(this._stringController=t.origin.index),this._bowController===this._stringController&&(this._stringController=void 0),this._controllerFollow&&(this._controllerFollow.side=this._bowController,this._controllerFollow.enabled=this._bowController!==void 0),this._isAiming=this._stringController!==void 0):t.button===0&&(this._isAiming=!0,this._stringPointerId=t.pointerId,this.getScreenDragPoint(t.pointerId,this._aimingPointerStartPos))},this.onRelease=t=>{var r;if(t.button===0){if(t.origin instanceof ue){const i=t.origin;if(this._isAiming&&i.index===this._stringController&&i.index!==this._bowController&&typeof this._bowController=="number"){const e=(r=V.active)==null?void 0:r.getController(this._bowController);if(i&&e){const n=i.gripWorldPosition;if(n){const a=e.gripWorldPosition.clone().sub(n);let l=e.object.worldPosition.distanceTo(i.object.worldPosition);l-=this.drawMinPhysicalDistance;const h=v.clamp01(l/this.drawMaxPhysicalDistance)*this.power;a.normalize().multiplyScalar(h),this.shoot(n,a),we&&E.DrawArrow(n,a.clone().add(n),16776960,1)}}}i.index===this._bowController&&(this._bowController=void 0),i.index===this._stringController&&(this._stringController=void 0),this._isAiming=this._bowController!==void 0&&this._stringController!==void 0,this._controllerFollow&&(this._controllerFollow.enabled=this._bowController!==void 0)}else{const i=this._aimingPointerStartPos,e=this.getScreenDragPoint(this._stringPointerId,w()),n=this.arrowSpawnSpot.getWorldPosition(w()),a=this.bowObject.getWorldDirection(w()).multiplyScalar(-1),l=i.distanceTo(e),h=v.clamp01(l/this.drawMaxPhysicalDistance)*this.power;a.normalize().multiplyScalar(h),this.shoot(n,a)}this._stringPointerId=void 0}}}get _hasControllers(){var t;return(((t=this.context.xr)==null?void 0:t.controllers.length)??0)>0}awake(){var t;(t=this.arrowPrefab)!=null&&t.asset&&(this.arrowPrefab.asset.visible=!1)}async onEnable(){var t;await((t=this.arrowPrefab)==null?void 0:t.loadAssetAsync()),this._isAiming=!1,this._controllerFollow=this.bowObject.getComponentInParent(yr)||null,this._initialBowObjectRotation=this.bowObject.quaternion.clone(),this._initialBowObjectPosition=this.bowObject.position.clone(),this._screenDragPlane.setFromNormalAndCoplanarPoint(w(0,1,-.2),this.bowObject.worldPosition),this.context.input.addEventListener("pointerdown",this.onDown),this.context.input.addEventListener("pointerup",this.onRelease),this.setupArrowInstances()}onDisable(){this._isAiming=!1,this.context.input.removeEventListener("pointerdown",this.onDown),this.context.input.removeEventListener("pointerup",this.onRelease)}onLeaveXR(){this.bowObject.quaternion.copy(this._initialBowObjectRotation),this.bowObject.position.copy(this._initialBowObjectPosition)}getPointerDistanceTo(t,r){const i=this.context.input.getPointerPosition(r);return t.distanceTo(i)}async setupArrowInstances(){var r,i,e;if(!this.arrowPrefab||!this.arrowSpawnSpot||this._drawingArrow)return;const t=await this.arrowPrefab.instantiate({parent:this.arrowSpawnSpot});t&&(t.visible=!0,t.worldScale=w(1,1,1),this._drawingArrow=t,(r=t.getComponent(ae))==null||r.destroy(),(i=t.getComponent(D))==null||i.destroy(),(e=t.getComponentInChildren(zt))==null||e.destroy(),t.getComponentsInChildren(mt).forEach(n=>n.destroy()))}async shoot(t,r){var d,u;if(!this.arrowPrefab)return;this._lastShotTimestamp=this.context.time.time;const i=t.clone(),e=i.clone().add(r),n=Math.pow(r.length()+.5,2),a=r.clone().normalize(),l=await this.arrowPrefab.instantiate({parent:this.context.scene});if(!l){console.error("Failed to instantiate arrow prefab, please check that objects are assigned correctly.");return}l.worldPosition=i,l.lookAt(e),l.visible=!0;const h=l.getComponent(D);h&&(h.isKinematic=!1,h.autoMass=!1,h.mass=.05,(d=this.sound)==null||d.stop(),(u=this.sound)==null||u.play(),await qt(1),h.applyImpulse(a.multiplyScalar(n),!0))}getScreenDragPoint(t,r){const i=this.context.input.getPointerPositionRC(t);this._screenDragRaycaster.setFromCamera(i,this.context.mainCamera);const e=this._screenDragRaycaster.ray;return this._screenDragRayLine.set(e.origin,e.direction.multiplyScalar(1e5)),this._screenDragPlane.intersectLine(this._screenDragRayLine,r)||r.set(0,0,0),we&&E.DrawWireSphere(r,.01,16711680,1),r}onBeforeRender(){if(!this.animationComponent||!this.bowObject)return;if(!this._mixer){this._mixer=new Wr(this.bowObject);const h=this.animationComponent.animations.at(0);h&&(this._animation=this._mixer.clipAction(h))}const t=.1;let r=0;const i=w(),e=w(),n=w(this.bowObject.worldUp);if(this._hasControllers){if(!this._isAiming)r=0,this._lastShotTimestamp=this.context.time.time;else if(this.context.xr&&this.context.xr.controllers.length>1&&this._bowController!==void 0&&this._stringController!==void 0){const h=this.context.xr.controllers[this._stringController],d=this.context.xr.controllers[this._bowController];if(!h||!d)return;i.copy(h.gripWorldPosition),e.copy(d.gripWorldPosition)}}else this._stringPointerId!==void 0&&(e.copy(this._aimingPointerStartPos),i.copy(this.getScreenDragPoint(this._stringPointerId,w())));if(this._isAiming&&i.dot(i)>0&&e.dot(e)>0){let h=i.distanceTo(e);r=v.clamp01((h-this.drawMinPhysicalDistance)/this.drawMaxPhysicalDistance),h>.025&&(this._tempLookMatrix.lookAt(i,e,n),this._tempLookRot.setFromRotationMatrix(this._tempLookMatrix),this.bowObject.worldQuaternion=this._tempLookRot)}this.drawProgression&&(r=this.drawProgression.evaluate(r)),!this._isAiming&&!this._hasControllers&&(r=.25),this._animation.timeScale=0;const a=v.lerp(this._animation.time,r,this.context.time.deltaTime/t),l=this._animation.time;if(this._animation.time=a,Math.abs(a-l)>Number.EPSILON&&(this._animation.setEffectiveWeight(1),this._animation.play()),this._mixer.update(this.context.time.deltaTime),this._drawingArrow){let d=(this.context.time.time-this._lastShotTimestamp)/.3;d=this.easeInOutSine(v.clamp01(d)),this._drawingArrow.worldScale=w(1,1,1).multiplyScalar(d)}}easeInOutSine(t){return v.clamp01(-.5*(Math.cos(Math.PI*t)-1))}}M([o(C)],j.prototype,"bowObject",2);M([o(dt)],j.prototype,"animationComponent",2);M([o(Oe)],j.prototype,"arrowPrefab",2);M([o(C)],j.prototype,"arrowSpawnSpot",2);M([o()],j.prototype,"power",2);M([o(Or)],j.prototype,"drawProgression",2);M([o()],j.prototype,"drawMaxPhysicalDistance",2);M([o()],j.prototype,"drawMinPhysicalDistance",2);M([o(U)],j.prototype,"sound",2);var Hs=Object.defineProperty,Gs=Object.getOwnPropertyDescriptor,qs=(s,t,r,i)=>{for(var e=i>1?void 0:i?Gs(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Hs(t,r,e),e};class er extends c{start(){this._meshRenderer=this.gameObject.getComponentInChildren(Pr)}onDestroy(){if(this.gameObject.visible&&this.particleSystem){if(this.particleSystem.shape.shapeType===St.MeshRenderer&&this._meshRenderer&&!Pe(this._meshRenderer.gameObject)){this.particleSystem.shape.shapeType=St.MeshRenderer,this.particleSystem.shape.setMesh(this._meshRenderer),this.particleSystem.play();return}this.particleSystem.shape.shapeType=St.Sphere,this.particleSystem.worldPosition=this.gameObject.worldPosition,this.particleSystem.play()}}}qs([o(zt)],er.prototype,"particleSystem",2);var Qs=Object.defineProperty,Ks=Object.getOwnPropertyDescriptor,Ys=(s,t,r,i)=>{for(var e=i>1?void 0:i?Ks(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Qs(t,r,e),e};class rr extends c{constructor(){super(...arguments),this._instances=new Array}awake(){var t,r;if(!((t=this.prefabs)!=null&&t.length)||((r=this.prefabs)==null?void 0:r.length)===0){console.warn("BowTargetSpawner start: no prefab set"),this.enabled=!1;return}this.prefabs.forEach(i=>i.visible=!1)}update(){var r;if(!((r=this.prefabs)!=null&&r.length))return;const t=w();for(let i=this._instances.length-1;i>=0;i--){const e=this._instances[i];Pe(e.instance)?this._instances.splice(i,1):(t.setScalar(e.scale),e.instance.scale.lerp(t,this.context.time.deltaTime))}if(this.context.time.frame%20===0&&Math.random()>.5){const i=this.worldPosition;i.x+=Math.random()*12-6,i.y+=Math.random()*3,i.z+=Math.random()*6;const e=Math.random()*3+.5,n=this.prefabs[Math.floor(Math.random()*this.prefabs.length)],a=Cr(n,{parent:this.scene,position:i.clone(),scale:new y(.01,.01,.01),keepWorldPosition:!0});a.visible=!0,this._instances.push({instance:a,scale:e}),setTimeout(()=>{a.destroy()},7e3),qt(1).then(()=>{const l=a.getComponentInChildren(D);l&&(l.gravityScale=.2+Math.random()*.3,l.mass=2,l.autoMass=!1),l==null||l.setAngularVelocity(v.random(-2,2),v.random(-2,2),v.random(-2,2)),l==null||l.applyImpulse({x:0,y:5+Math.random()*12,z:0})})}}}Ys([o(C)],rr.prototype,"prefabs",2);class Zs extends c{awake(){this.context.renderer.toneMapping=zr,ge.occlusion_fragment=ge.occlusion_fragment.replace("gl_FragColor *= 1.0 - occlusion;",`
float depthMm = Depth_GetCameraDepthInMeters(depthColor, depthUv, arrayIndex);

// requires also patching ShaderChunk.occlusion_pars_fragment and adding some noise function
// float noise = snoise(gl_FragCoord.xy * 0.005);
// depthMm += noise * 0.002;

float absDistance = abs(assetDepthM - depthMm);
float v = 0.0025;
absDistance = saturate(v - absDistance) / v;

gl_FragColor.rgb += vec3(absDistance * 2.0, absDistance * 2.0, absDistance * 12.0);
gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 0.0, 0.0), occlusion * 0.7);
`)}}class ks extends c{constructor(){super(...arguments),this.interval=-1,this.supportsAR=!1,this.supportsVR=!1}async onEnable(){this.log(!0),this.interval=setInterval(()=>this.log(),500),this.supportsAR=await V.isARSupported(),this.supportsVR=await V.isVRSupported()}onDisable(){clearInterval(this.interval)}async log(t=!1){t&&(console.log("UserAgent",window.navigator.userAgent),console.log("isMobileDevice",x.isMobileDevice()),console.log("isiOSDevice",x.isiOS()),console.log("isMozillaXR",x.isMozillaXR()),console.log("isSafari",x.isSafari()),console.log("isQuest",x.isQuest()),console.log("isMacOS",x.isMacOS()),console.log("isVisionOS",x.isVisionOS())),f("AR: "+r(this.supportsAR)+", VR: "+r(this.supportsVR)+", QuickLook: "+r(x.supportsQuickLookAR())),x.isMobileDevice()?x.isiOS()?f("iOS 🍎"):window.navigator.userAgent.indexOf("Android")>-1?f("Android 🤖"):f("Other Mobile 📱"):x.isDesktop()?f("Desktop 🖥️"):f("Other Device 🌏"),x.isMobileDevice()&&x.isiOS()&&x.isSafari()?f("Safari 🌏"):x.isMozillaXR()?f("Mozilla XR 🦊"):x.isQuest()?f("Quest 🎮"):window.navigator.userAgent.indexOf("Chrome")>-1?f("Chrome 🌏"):f("Other Browser 🌏"),f("UserAgent: "+window.navigator.userAgent);function r(i){return i?"✅":"❌"}}}class Bs extends c{onEnable(){const t=m.findObjectOfType(Gt);t&&(t.anchoringType="plane",t.planeAnchoringAlignment="vertical")}}var Xs=Object.defineProperty,Js=Object.getOwnPropertyDescriptor,et=(s,t,r,i)=>{for(var e=i>1?void 0:i?Js(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Xs(t,r,e),e};class W extends c{constructor(){super(...arguments),this.distance=.5,this.fadeDuration=1,this.targetState=!0,this.hideOnStart=!0,this.tempVector=new y}start(){this.hideOnStart&&!x.isiOS()&&this.target.scale.set(0,0,0)}update(){this.tempVector.copy(this.context.mainCameraComponent.worldPosition),this.tempVector.sub(this.worldPosition).length()<this.distance&&(this.enabled=!1)}createBehaviours(t,r,i){if(r.uuid===this.gameObject.uuid){const e=this.target?this.target:this.gameObject;this.hideOnStart&&t.addBehavior(new $("SetActiveOnProximity_active_"+this.gameObject.name,A.sceneStartTrigger(),_.fadeAction(e,0,!this.targetState))),t.addBehavior(new $("SetActiveOnProximity_"+this.gameObject.name,A.proximityToCameraTrigger(this.gameObject,this.distance),_.fadeAction(e,this.fadeDuration,this.targetState)))}}}et([o(m)],W.prototype,"target",2);et([o()],W.prototype,"distance",2);et([o()],W.prototype,"fadeDuration",2);et([o()],W.prototype,"targetState",2);et([o()],W.prototype,"hideOnStart",2);var tn=Object.defineProperty,en=Object.getOwnPropertyDescriptor,oe=(s,t,r,i)=>{for(var e=i>1?void 0:i?en(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&tn(t,r,e),e};class _t extends c{constructor(){super(...arguments),this.getCloseClip="",this.distance=.5,this.lastDistance=void 0}update(){const t=this.gameObject.worldPosition.distanceTo(this.context.mainCameraComponent.worldPosition);this.lastDistance!==void 0&&t<this.distance&&this.lastDistance>=this.distance&&this.target.play(this.getCloseClip),this.lastDistance=t}createBehaviours(t,r,i){if(r.uuid===this.gameObject.uuid){const e=this.target?this.target.gameObject:this.gameObject,n=i.extensions.find(h=>h instanceof jr);if(!n){console.warn("No AnimationExtension found",i.extensions);return}let a;const l=fe.getAndRegisterAnimationSequences(n,e,this.getCloseClip);if(l)a=fe.getActionForSequences(e,l.animationSequence,l.animationLoopAfterSequence,l.randomTimeOffset);else{console.warn("No animation sequence found for "+this.getCloseClip,l);return}t.addBehavior(new $("PlayAnimationOnProximity_"+this.gameObject.name,A.proximityToCameraTrigger(this.gameObject,this.distance),a));return}}}oe([o(Ht)],_t.prototype,"target",2);oe([o()],_t.prototype,"getCloseClip",2);oe([o()],_t.prototype,"distance",2);var rn=Object.defineProperty,sn=Object.getOwnPropertyDescriptor,Ot=(s,t,r,i)=>{for(var e=i>1?void 0:i?sn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&rn(t,r,e),e};class rt extends c{constructor(){super(...arguments),this.distance=.5,this.targetState=!0}createBehaviours(t,r,i){}async afterSerialize(t,r){}}Ot([o(U)],rt.prototype,"target",2);Ot([o(URL)],rt.prototype,"clip",2);Ot([o()],rt.prototype,"distance",2);Ot([o()],rt.prototype,"targetState",2);var nn=Object.defineProperty,an=Object.getOwnPropertyDescriptor,z=(s,t,r,i)=>{for(var e=i>1?void 0:i?an(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&nn(t,r,e),e};class yt{constructor(){this.contents=[],this.negativeContents=[],this.triggers=[]}}z([o(C)],yt.prototype,"contents",2);z([o(C)],yt.prototype,"negativeContents",2);z([o(C)],yt.prototype,"triggers",2);class Pt extends c{constructor(){super(...arguments),this.elements=[],this.fadeDuration=.2,this.selectFirstOnStart=!0,this._allTargets=[],this._allTriggers=[]}get currentIndex(){return this._currentIndex}get defaultVariant(){const t=this.selectFirstOnStart?this.elements.at(0):void 0;return this._currentIndex!==void 0?this.elements.at(this._currentIndex):t}awake(){this.elements.forEach(t=>{t.contents=t.contents.filter(r=>r),t.triggers=t.triggers.filter(r=>r)}),this.elements.forEach(t=>{var r;return(r=t.contents)==null?void 0:r.forEach(i=>this._allTargets.push(i))}),this.elements.forEach(t=>{var r;return(r=t.triggers)==null?void 0:r.forEach(i=>this._allTriggers.push(i))}),this.setupForRuntime()}setupForRuntime(){this.elements.forEach((t,r)=>{var i;(i=t.triggers)==null||i.forEach(e=>{const n=Sr(e,Wt);n.onClick??(n.onClick=new b),n.onClick.addEventListener(()=>{this._currentIndex=r,this._allTargets.forEach(a=>{a.visible=t.contents.includes(a)})})})}),this.selectDefault()}selectDefault(){var r;const t=((r=this.defaultVariant)==null?void 0:r.contents)??[];this._allTargets.forEach(i=>{i.visible=t.includes(i)})}createBehaviours(t,r,i){r.uuid===this.gameObject.uuid&&this.setupForUSDZ(t)}beforeCreateDocument(t,r){this._allTargets.forEach(i=>{i.visible=!0})}async afterSerialize(t,r){await qt(3),this.selectDefault()}setupForUSDZ(t){var e;this.elements.forEach(n=>{var a;(a=n.triggers)==null||a.forEach(l=>{const h=n.contents,d=this._cloneArray(this._allTargets).filter(u=>!h.includes(u));h.length>=0&&t.addBehavior(new $(`EnableObject_${l.uuid}`,A.tapTrigger(l),_.fadeAction(h,this.fadeDuration,!0))),d.length>=0&&t.addBehavior(new $(`DisableObject_${l.uuid}`,A.tapTrigger(l),_.fadeAction(d,this.fadeDuration,!1)))})});const r=((e=this.defaultVariant)==null?void 0:e.contents)??[],i=this._cloneArray(this._allTargets).filter(n=>!r.includes(n));t.addBehavior(new $(`HideOnStart_${this.guid}`,A.sceneStartTrigger(),_.fadeAction(i,0,!1)))}_cloneArray(t){const r=new Array(t.length);return t.forEach((i,e)=>r[e]=i),r}}z([o(yt)],Pt.prototype,"elements",2);z([o()],Pt.prototype,"fadeDuration",2);z([o()],Pt.prototype,"selectFirstOnStart",2);var on=Object.defineProperty,ln=Object.getOwnPropertyDescriptor,T=(s,t,r,i)=>{for(var e=i>1?void 0:i?ln(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&on(t,r,e),e};class R{constructor(){this.name="Name"}}T([o()],R.prototype,"name",2);T([o(ut)],R.prototype,"icon",2);T([o(b)],R.prototype,"click",2);class H{constructor(){this.title="Title",this.items=[]}}T([o()],H.prototype,"title",2);T([o(ut)],H.prototype,"icon",2);T([o(b)],H.prototype,"select",2);T([o(b)],H.prototype,"deselect",2);T([o(R)],H.prototype,"items",2);class it extends c{constructor(){super(...arguments),this.categories=[]}awake(){document.body.insertAdjacentHTML("afterbegin",`<style>${mn}</style>`),document.body.insertAdjacentHTML("afterbegin",dn),this.mainmenu=document.querySelector(".mainmenu"),this.submenuRoot=document.querySelector(".submenu-wrapper"),this.submenu=document.querySelector(".submenu"),this.submenuTitle=document.querySelector(".submenu-title"),this.submenuContent=document.querySelector(".submenu-content"),this.categories.forEach(t=>this.addCategory(t)),this.hideSubmenu()}addNewCategory(t){this.categories.push(t),this.addCategory(t)}addCategory(t){if(!this.mainmenu)return;const r=cn(t);this.mainmenu.appendChild(r),r.onclick=()=>{this.selectedCategory===t?this.hideSubmenu():this.showSubmenu(t)}}addItem(t){if(!this.submenuContent)return;const r=pn(t);this.submenuContent.appendChild(r),r.onclick=()=>{var i;(i=t.click)==null||i.invoke()}}showSubmenu(t){var r,i,e,n;for(this.selectedCategory=t,(i=(r=this.selectedCategory)==null?void 0:r.select)==null||i.invoke(),this.submenuTitle&&(this.submenuTitle.textContent=t.title);(e=this.submenuContent)!=null&&e.firstChild;)this.submenuContent.removeChild(this.submenuContent.firstChild);t.items.forEach(a=>this.addItem(a)),(n=this.submenuRoot)==null||n.classList.remove("close")}hideSubmenu(){var t,r,i,e,n;for((r=(t=this.selectedCategory)==null?void 0:t.deselect)==null||r.invoke(),this.selectedCategory=void 0;(i=this.submenuContent)!=null&&i.firstChild;)(e=this.submenuContent)==null||e.removeChild(this.submenuContent.firstChild);(n=this.submenuRoot)==null||n.classList.add("close")}}T([o(H)],it.prototype,"categories",2);const hn="https://upload.wikimedia.org/wikipedia/commons/2/21/City_locator_4.svg",cn=s=>{var r;const t=document.createElement("button");return t.classList.add("room"),t.classList.add("open-submenu"),t.innerHTML=`
        <button class="open-submenu">
            <span class="icon">
                <img src=${((r=s.icon)==null?void 0:r.url)??hn} alt=${s.title??"?"}>
            </span>
        </button>
    `,t},pn=s=>{var e;const t=document.createElement("button");t.classList.add("submenu-button");const r=`
        <img src=${(e=s.icon)==null?void 0:e.url} alt=${s.name??"?"}>
    `,i=`
        <a>${s.name}</a>
    `;return s.icon&&(t.innerHTML+=r),t.innerHTML+=i,t},dn=`
  <div class="mainmenu">
    <!-- Content -->
  </div>

  <div class="submenu-wrapper">
    <h2 class="submenu-title"></h2>
    <div class="submenu">
        <div class="submenu-content">
            <!-- Content -->
        </div>
    </div>
  </div>
`,mn=`
.mainmenu {
    position: absolute;
    top: 16px;
    right: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 54px;
    height: auto;
    background: rgba(229, 230, 233, 0.8);
    border-radius: 27px;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    box-shadow: 0 0 4px rgba(2, 2, 43, 0.2);
    z-index: 1;
    padding-top: 6px;

    /* default font settings */
    font-size: 1rem;
    font-family: 'Roboto Flex', sans-serif;
    /* font-optical-sizing: auto; */
    /* font-variation-settings: "width" 100; */
    color: rgb(40, 40, 40);
}

.mainmenu button {
    width: 42px;
    height: 42px;
    border: none;
    border-radius: 50%;
    margin-bottom: 4px;
    background: transparent;
    transition: background-color 0.5s;
    outline: rgba(0, 0, 0, 0) 1px solid;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

.mainmenu button.active,
.mainmenu button:hover {
    background: rgba(245, 245, 245, .8);
    transition: all 0.1s linear .02s;
    outline: rgba(0, 0, 0, .05) 1px solid;
}

.mainmenu button.active img,
.mainmenu button:hover img
{
    /* filter: invert(100%) sepia(0%) saturate(7478%) hue-rotate(317deg) brightness(109%) contrast(99%); */
}

.mainmenu button img {
    width: 32px;
    height: 32px;
}

.mainmenu button .state-icon {
    position: absolute;
    top: 9px;
    left: 11px;
    width: 32px; 
    height: 32px; 
    background-size: cover;
    background-repeat: no-repeat;
    pointer-events: none; 
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

.mainmenu button.active .state-icon,
.mainmenu button:hover .state-icon
{
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

/*Submenu*/
.submenu-wrapper {
    position: absolute;
    top: 16px;
    right: calc(70px + 10px);
    width: 333px;
    max-height: 60vh;
    padding: 22px;
    z-index: 1;

    background: #ffffff5c;
    border: 1px solid rgba(255, 255, 255, .1);
    border-radius: 1.1999rem;
    outline: rgb(0 0 0 / 5%) 1px solid;
    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0, 0, 0, .05);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);

    overflow: hidden;
}

.submenu {
    overflow-x: hidden;
    overflow-y: scroll;
    max-height: calc(60vh - 22px * 2);
    font-family: 'Roboto Flex', sans-serif;
}

/* width */
.submenu::-webkit-scrollbar {
    scrollbar-color: #ff0000;
    width: 5px;
}

/* Track */
.submenu::-webkit-scrollbar-track {
    background: #8880;
    margin-right: 20px;
}

/* Handle */
.submenu::-webkit-scrollbar-thumb {
    background: #8888;
    border-radius: 10px; /* Rounded corners */
    margin: 0 8px; /* Offset the track to move the thumb left */
}

/* Handle on hover */
.submenu::-webkit-scrollbar-thumb:hover {
    background: #555A;
}

.submenu-title {
    color: #282828;
    font-size: 22px;
    font-weight: 800;
    line-height: 32px;
    margin-bottom: 16px;
    margin-top: 0px;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    border-bottom: 1px solid rgba(40, 40, 40, .4);
    font-family: 'Roboto Flex', sans-serif;
}

.submenu-button {
    height: 1.8rem;
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-size: 1rem;
    line-height: 32px;
    border: none;
    cursor: pointer;
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 200;
    width: 100%;
    
    background: transparent;
    outline: rgba(0, 0, 0, 0) 1px solid;
    border-radius: 0.8rem;
}

.submenu-button:hover { 
    background: rgba(245, 245, 245, .8);
    transition: all 0.1s linear .02s;
    outline: rgba(0, 0, 0, .05) 1px solid;
}

.submenu-button img {
    width: 32px;
    height: 32px;
    margin-right: 6px;
    margin-left: -6px;
}

.submenu-button a {
    color: #282828;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
}

.submenu-content img {
    max-width: 100%;
    height: auto;
    margin-right: 6px;
}

.special {
    display: flex;
    align-items: center;
    margin-top: 16px;
    font-size: 13px;
    line-height: 20px;
    color: #919191;
    border: none;
    background: none;
}

.special img {
    width: 16px;
    height: 16px;
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

.submenu-wrapper.close {
    display: none;
}

@media screen and (max-width: 768px) {
    .mainmenu {
        width: 42px;
        height: auto;
        padding-bottom: 2px;
    }

    .mainmenu button {
        width: 32px;
        height: 32px;
    }

    .mainmenu button img {
        width: 24px;
        height: 24px;
    }

    .mainmenu button .state-icon {
        position: absolute;
        top: 9px;
        left: 9px;
        width: 24px; 
        height: 24px; 
    }

    .submenu-wrapper {
        right: calc(60px + 5px);
        width: 256px;
        border-radius: 21px;
        padding: 16px;
        max-height: 40vh;
    }

    .submenu {
        max-height: calc(40vh - 16px * 2);
    }

    .submenu-title {
        font-size: 18px;
        line-height: 28px;
        margin-bottom: 10px;
    }

    .submenu-button {
        margin-bottom: 6px;
        /* font-size: 1.3rem; */
        line-height: 24px;
    }

    .submenu-button img {
        width: 24px;
        height: 24px;
    }

    .special {
        margin-top: 10px;
        font-size: 11px;
    }

    .special img {
        width: 10px;
        height: 10px;
    }
}`;var un=Object.defineProperty,fn=Object.getOwnPropertyDescriptor,G=(s,t,r,i)=>{for(var e=i>1?void 0:i?fn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&un(t,r,e),e};class le{}G([o(Wt)],le.prototype,"button",2);G([o(Y)],le.prototype,"label",2);class st extends c{constructor(){super(...arguments),this.categoryName="",this.data=[]}awake(){var r;this.galleryUI??(this.galleryUI=Ce(it));const t=(r=this.galleryUI)==null?void 0:r.categories.find(i=>i.title===this.categoryName);t&&this.data.forEach(i=>{var n,a;const e=new R;e.name=((n=i.label)==null?void 0:n.text)||"",e.icon=this.icon,e.click=new b,(a=e.click)==null||a.addEventListener(()=>{var l,h;(h=(l=i.button)==null?void 0:l.onClick)==null||h.invoke()}),t.items.push(e)})}}G([o(it)],st.prototype,"galleryUI",2);G([o()],st.prototype,"categoryName",2);G([o(ut)],st.prototype,"icon",2);G([o(le)],st.prototype,"data",2);var gn=Object.defineProperty,bn=Object.getOwnPropertyDescriptor,ir=(s,t,r,i)=>{for(var e=i>1?void 0:i?bn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&gn(t,r,e),e};class Ct extends c{constructor(){super(...arguments),this.title="",this.slug=""}initialize(t){this.galleryManager=t}start(){this.slug=xn(this.title),P("poi")===this.slug&&this.focus()}focus(){var t,r;Rt("poi",this.slug),(t=this.galleryManager)==null||t.poiFocused(this),this.cameraView&&(this.previousOrbitControls??(this.previousOrbitControls=Ce(Ut)),(r=this.previousOrbitControls)==null||r.setCameraAndLookTarget(this.cameraView))}focusNext(){var t;(t=this.galleryManager)==null||t.focusNext()}focusPrevious(){var t;(t=this.galleryManager)==null||t.focusPrevious()}}ir([o(C)],Ct.prototype,"cameraView",2);ir([o()],Ct.prototype,"title",2);function xn(s){return s.trim().toLowerCase().replace(/ /g,"-")}var wn=Object.defineProperty,vn=Object.getOwnPropertyDescriptor,nt=(s,t,r,i)=>{for(var e=i>1?void 0:i?vn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&wn(t,r,e),e};class q extends c{constructor(){super(...arguments),this.pois=[],this.categoryName="",this.arrowKeysNavigation=!0,this.selectedPOIIndex=0}awake(){this.populateGalleryUI(this.pois),this.pois.forEach(t=>t.initialize(this))}populateGalleryUI(t){var i;if(!this.galleryUI)return;const r=(i=this.galleryUI)==null?void 0:i.categories.find(e=>e.title===this.categoryName);r&&t.forEach(e=>{const n=new R;n.name=e.title,n.icon=this.icon,n.click=new b,n.click.addEventListener(()=>{e.focus()}),r.items.push(n)})}poiFocused(t){const r=this.pois.indexOf(t);r!=-1&&(this.selectedPOIIndex=r)}focusNext(){var t;this.selectedPOIIndex=(this.selectedPOIIndex+1)%this.pois.length,(t=this.pois[this.selectedPOIIndex])==null||t.focus()}focusPrevious(){var t;this.selectedPOIIndex=(this.selectedPOIIndex-1+this.pois.length)%this.pois.length,(t=this.pois[this.selectedPOIIndex])==null||t.focus()}update(){if(this.arrowKeysNavigation){const t=this.context.input;t.isKeyDown("ArrowRight")?this.focusNext():t.isKeyDown("ArrowLeft")&&this.focusPrevious()}}}nt([o(Ct)],q.prototype,"pois",2);nt([o(it)],q.prototype,"galleryUI",2);nt([o()],q.prototype,"categoryName",2);nt([o(ut)],q.prototype,"icon",2);nt([o()],q.prototype,"arrowKeysNavigation",2);var _n=Object.defineProperty,On=Object.getOwnPropertyDescriptor,sr=(s,t,r,i)=>{for(var e=i>1?void 0:i?On(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&_n(t,r,e),e};const Mt=P("debugmaterialx");class he extends c{constructor(){super(...arguments),this.images=[]}async awake(){this.materialXAsset&&this.loadMaterialX(this.materialXAsset)}async loadMaterialX(t){const r=m.getComponent(this.gameObject,O);if(!r)return;const i=new Rr;i.resolveURL=a=>{if(a.startsWith("assets/"))return a;const h=a.split("/").pop();return Mt&&console.log("resolveURL",a,h),"assets/"+h};const n=await new Br(i).setPath("").loadAsync(t).then(({materials:a})=>(Mt&&console.log("Loaded .mtlx materials",a),Object.values(a)[0]));Mt&&console.log("Loaded .mtlx material",n,t),n&&(r.sharedMaterial=n)}}sr([o(URL)],he.prototype,"materialXAsset",2);sr([o(Dr)],he.prototype,"images",2);const yn=P("debugmaterialx");class Pn extends c{start(){const t=m.getComponent(this.gameObject,O);t&&(this.material=new Hr({}),t.sharedMaterial=this.material,this.constructNodeGraph(this.material),this.material.needsUpdate=!0)}constructNodeGraph(t){const r=Gr(1),i=qr.mul(10).add(r),e=Qr(i);t.colorNode=e}update(){if(K()&&this.material&&this.constructNodeGraph!==this.methodCacheKey){yn&&console.log("rebuilding node graph"),this.methodCacheKey=this.constructNodeGraph;try{this.constructNodeGraph(this.material),this.material.needsUpdate=!0}catch(t){throw console.error(t),f(t.message,ye.Error),t}}}}var Cn=Object.defineProperty,jn=Object.getOwnPropertyDescriptor,Sn=(s,t,r,i)=>{for(var e=i>1?void 0:i?jn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Cn(t,r,e),e};class Vt extends c{constructor(){super(...arguments),this.time=0,this._timeThreshold=.3}awake(){this._director=this.gameObject.getComponentInChildren(Mr)??void 0}onAfterRender(){if(!this._director)return;Math.abs(this._director.time-this.time)>this._timeThreshold&&(this.time=this._director.time)}onTimeChanged(){!this._director||Math.abs(this._director.time-this.time)<this._timeThreshold||(this._director.time=this.time,this._director.isPlaying||this._director.evaluate())}}Sn([I(Vt.prototype.onTimeChanged)],Vt.prototype,"time",2);var Dn=Object.defineProperty,Mn=Object.getOwnPropertyDescriptor,Q=(s,t,r,i)=>{for(var e=i>1?void 0:i?Mn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Dn(t,r,e),e};class F extends c{constructor(){super(...arguments),this.consumeClick=!0,this.consumeDown=!0,this.consumeMove=!0,this.consumeUp=!0,this.consumeHover=!0,this.stopPropagation=!0}onPointerDown(t){this.consumeDown&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerMove(t){this.consumeMove&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerUp(t){this.consumeUp&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerClick(t){this.consumeClick&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerEnter(t){this.consumeHover&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerExit(t){this.consumeHover&&t.use(),this.stopPropagation&&t.stopPropagation()}}Q([o()],F.prototype,"consumeClick",2);Q([o()],F.prototype,"consumeDown",2);Q([o()],F.prototype,"consumeMove",2);Q([o()],F.prototype,"consumeUp",2);Q([o()],F.prototype,"consumeHover",2);Q([o()],F.prototype,"stopPropagation",2);var Tn=Object.defineProperty,En=Object.getOwnPropertyDescriptor,$n=(s,t,r,i)=>{for(var e=i>1?void 0:i?En(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Tn(t,r,e),e};class nr extends c{constructor(){super(...arguments),this.renderers=[]}select(t){this.renderers.forEach(r=>{r.probeAnchor=t})}}$n([o(O)],nr.prototype,"renderers",2);var An=Object.defineProperty,In=Object.getOwnPropertyDescriptor,Ln=(s,t,r,i)=>{for(var e=i>1?void 0:i?In(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&An(t,r,e),e};class ce extends c{constructor(){super(...arguments),this.displayName=""}}Ln([o()],ce.prototype,"displayName",2);var Fn=Object.defineProperty,Nn=Object.getOwnPropertyDescriptor,jt=(s,t,r,i)=>{for(var e=i>1?void 0:i?Nn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Fn(t,r,e),e};class at extends c{constructor(){super(...arguments),this.objects=[],this.hideContentOnStart=!0,this.index=-1}awake(){this.hideContentOnStart||(this.index=0);const t=P("variant");typeof t=="string"?this.index=parseInt(t):typeof t=="number"&&(this.index=t),this.apply()}next(){this.select(this.index+1)}previous(){this.select(this.index-1)}apply(){for(let t=0;t<this.objects.length;t++)this.objects[t].visible=t===this.index;if(this.lable){const t=this.objects[this.index];if(t){const r=m.getComponent(t,ce);this.lable.text=(r==null?void 0:r.displayName)??t.name}}}select(t){t<0&&(t=this.objects.length-1),this.index=t%this.objects.length,this.index=v.clamp(this.index,0,this.objects.length-1),Rt("variant",this.index.toString()),this.apply()}}jt([o(C)],at.prototype,"objects",2);jt([o()],at.prototype,"hideContentOnStart",2);jt([o(Y)],at.prototype,"lable",2);jt([I(function(){this.apply()})],at.prototype,"index",2);p.add("AspectRatioFitterUI",Kt);p.add("CameraGoal",ft);p.add("CameraLayer",ri);p.add("Cannon",Z);p.add("RandomColor",Zt);p.add("ChangeColorOnCollision",oi);p.add("IncreaseShaderSpeedOverTime",$e);p.add("ClickButton",Ae);p.add("ClickToReset",Ie);p.add("DepthOfFieldController",bt);p.add("DisableEnvironmentLight",wi);p.add("EmitParticlesOnClick",Le);p.add("EnforceParameters",Fe);p.add("HTMLButtonClick",Bt);p.add("HTMLMenu",Xt);p.add("IFrameContent",k);p.add("ImageTrackingDownloadUI",Ai);p.add("LODGroupUI",Jt);p.add("Networking_ClickToChangeColor",It);p.add("Networking_StringArray",Lt);p.add("Networking_Object",Ft);p.add("PerformanceSettings",ee);p.add("Photographer",B);p.add("PhysicsCollision",X);p.add("PhysicsTrigger",J);p.add("PlayAnimationOnCollision",ze);p.add("PlayAnimationOnTrigger",Re);p.add("PlayAudioOnCollision",He);p.add("ResetAnimationsForXR",ts);p.add("ResponsiveContent",re);p.add("LoadingSceneRoot",qe);p.add("SceneLoadingEvents",se);p.add("SceneSwitcherControls",ns);p.add("SetBackfaceCulling",as);p.add("ShowBalloonMessage",Qe);p.add("SimpleLeaderboard",Nt);p.add("StartPosition",Ke);p.add("AutoReset",Ye);p.add("SyncedRoomUI",Ze);p.add("TimedSpawn",ke);p.add("TopMenu",Be);p.add("VideoBackground",js);p.add("ResetPositionOnInterval",tt);p.add("ToggleVisibility",Ms);p.add("WireframeMaterial",Xe);p.add("XRLifecycleEvents",ne);p.add("WebXRBodyTracking",Ls);p.add("Arrow",ae);p.add("ArrowShooting",j);p.add("BowArrowTarget",er);p.add("BowTargetSpawner",rr);p.add("CustomDepthSensing",Zs);p.add("DeviceDetection",ks);p.add("CustomUSDSettings",Bs);p.add("FadeOnProximity",W);p.add("PlayAnimationOnProximity",_t);p.add("SoundOnProximity",rt);p.add("EverywhereConfigurator",Pt);p.add("ButtonAndTextFiller",st);p.add("GalleryManager",q);p.add("GalleryPOI",Ct);p.add("GalleryUI",it);p.add("MaterialXAsset",he);p.add("ShadeWithMaterialX",Pn);p.add("SyncedPlayableDirector",Vt);p.add("ConsumeAllPointers",F);p.add("ReflectionsSwitcher",nr);p.add("VariantInfo",ce);p.add("VariantSwitcher",at);var Vn=Object.defineProperty,Un=Object.getOwnPropertyDescriptor,ar=(s,t,r,i)=>{for(var e=i>1?void 0:i?Un(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Vn(t,r,e),e};const Tt=3;class pe extends c{constructor(){super(...arguments),this.chats=[],this.geometry=[],this.onPlaneTracking=t=>{console.error(t.detail.context.mesh);const r=t.detail.context.mesh,i=r.material instanceof Array?r.material[0]:r.material;this.geometry.push({geometry:r.geometry,material:i,version:Tt,pose:r.matrixWorld}),this.geometry=this.geometry.filter(e=>e.version===Tt)}}onEnable(){const t=m.findObjectOfType(je);t==null||t.addEventListener("plane-tracking",this.onPlaneTracking),console.log(this.guid,this)}onNewQuads(t){console.warn("new quads",t)}onNewGeometry(t){console.log("new geometry",this.guid,t);for(let r=0;r<t.length;r++){const i=t[r];if(i.version===Tt)try{const n=new Kr().parse(i.material),l=new Yr().parse(i.geometry),h=new Me(l,n),d=i.pose.elements;h.matrix.fromArray(d),h.matrix.decompose(h.position,h.quaternion,h.scale),this.gameObject.add(h),m.setActive(h,!0),console.log(h)}catch(e){console.warn(e)}}}addNewQuad(t){console.warn("received value",t),this.chats.push(t),this.chats=this.chats}}ar([I("onNewQuads")],pe.prototype,"chats",2);ar([I("onNewGeometry")],pe.prototype,"geometry",2);class Wn extends c{async start(){const t=this.context.domElement.shadowRoot.querySelector(".webxr-buttons");if(!t){console.warn("Could not find webxr-buttons element");return}this.appendWebXRButtonsStyle();const r=document.createElement("button");r.className="webxr-button",r.innerHTML=" 🎁 Launch</br>on Quest",r.onclick=()=>{window.open("https://www.oculus.com/open_url/?url="+document.URL,"_blank")},m.findObjectOfType(_e);const i=await V.isARSupported(),e=await V.isVRSupported(),n=Tr.getOrCreate(),a=n.createARButton(),l=n.createVRButton(),h=document.createElement("button");Dt()?h.innerHTML="Passthrough":h.innerHTML="AR",i&&h.addEventListener("click",()=>{a.click()}),i?h.classList.add("supported"):h.classList.add("not-supported");const d=document.createElement("button");d.innerHTML="VR",e&&d.addEventListener("click",()=>{l.click()}),e?d.classList.add("supported"):d.classList.add("not-supported");const u=document.createElement("span");u.innerHTML="Make sure to complete</br>Room Setup with walls.",Dt()&&t.appendChild(u),t.appendChild(h),t.appendChild(d),Dt()||t.appendChild(r)}appendWebXRButtonsStyle(){const t=document.createElement("style");t.innerHTML=`
        needle-engine .webxr-buttons {
            align-items: center;
        }

        .webxr-buttons button {
            text-transform: uppercase;
            border:1px solid black;
            background: grey;
            border-radius: 5px;
            padding: 10px;
            color: white;
            transition: background 0.2s;
            cursor: pointer;
        }

        .webxr-buttons button.not-supported {
            display: none;
        }
        
        .webxr-buttons button:hover {
            background: #333;
        }

        .webxr-buttons span {
            color: white;
        }

        .webxr-buttons a {
            font-size: 30px;
        }
        `,this.context.domElement.shadowRoot.appendChild(t)}}class zn extends c{awake(){const t=this.gameObject.getComponent(O);if(!t)return;const r=t.sharedMaterial.clone();t.sharedMaterial=r,r.color.setHex(Math.random()*16777215)}}var Rn=Object.defineProperty,Hn=Object.getOwnPropertyDescriptor,Gn=(s,t,r,i)=>{for(var e=i>1?void 0:i?Hn(t,r):t,n=s.length-1,a;n>=0;n--)(a=s[n])&&(e=(i?a(t,r,e):a(e))||e);return i&&e&&Rn(t,r,e),e};class or extends c{constructor(){super(...arguments),this.materials=[],this.renderer=null}start(){const t=m.findObjectOfType(je);if(t){const i=t.trackedPlanes;for(const e of i)if(e.mesh===this.gameObject){const n=e.xrData;console.log("this mesh is part of a "+n.semanticLabel)}}if(this.renderer=this.gameObject.getComponent(O),!this.renderer)return;const r=this.renderer.sharedMaterial.clone();this.renderer.sharedMaterial=r,r.color.setHex(Math.random()*16777215),this.renderer&&(this.materials=[...this.materials,this.renderer.sharedMaterial,this.blockerMaterial(),this.wireframeMaterial()]),m.setActive(this.gameObject,!0)}onPointerClick(){if(!this.renderer)return;const t=this.renderer.sharedMaterial,i=(this.materials.indexOf(t)+1)%this.materials.length,e=this.materials[i];this.renderer.sharedMaterial=e,"_renderOrder"in e?this.gameObject.renderOrder=e._renderOrder:this.gameObject.renderOrder=0}blockerMaterial(){const t=new be;return t.colorWrite=!1,t.depthWrite=!0,t.transparent=!1,t._renderOrder=-1e3,t}wireframeMaterial(){const t=new be;return t.colorWrite=!0,t.depthWrite=!1,t.transparent=!1,t.wireframe=!0,t}}Gn([o(Qt)],or.prototype,"materials",2);p.add("NetworkedQuads",pe);p.add("PresencePlatformUI",Wn);p.add("RandomPlaneColor",zn);p.add("RevealWorldBehind",or);
